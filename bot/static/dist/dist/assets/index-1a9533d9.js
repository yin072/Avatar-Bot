import{r as A,c as oe,o as c,a as g,b as s,n as T,t as E,d as I,F as q,e as ee,f as ce,w as O,v as R,g as de,h as J,i as ue,j as ge,k as he,l as fe,m as H,p as ve,q as j,s as me}from"./vendor-2cf3039e.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))i(n);new MutationObserver(n=>{for(const l of n)if(l.type==="childList")for(const a of l.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&i(a)}).observe(document,{childList:!0,subtree:!0});function o(n){const l={};return n.integrity&&(l.integrity=n.integrity),n.referrerPolicy&&(l.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?l.credentials="include":n.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function i(n){if(n.ep)return;n.ep=!0;const l=o(n);fetch(n.href,l)}})();const pe="modulepreload",ye=function(t){return"/"+t},ae={},G=function(e,o,i){if(!o||o.length===0)return e();const n=document.getElementsByTagName("link");return Promise.all(o.map(l=>{if(l=ye(l),l in ae)return;ae[l]=!0;const a=l.endsWith(".css"),d=a?'[rel="stylesheet"]':"";if(!!i)for(let v=n.length-1;v>=0;v--){const S=n[v];if(S.href===l&&(!a||S.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${l}"]${d}`))return;const h=document.createElement("link");if(h.rel=a?"stylesheet":pe,a||(h.as="script",h.crossOrigin=""),h.href=l,document.head.appendChild(h),a)return new Promise((v,S)=>{h.addEventListener("load",v),h.addEventListener("error",()=>S(new Error(`Unable to preload CSS for ${l}`)))})})).then(()=>e()).catch(l=>{const a=new Event("vite:preloadError",{cancelable:!0});if(a.payload=l,window.dispatchEvent(a),!a.defaultPrevented)throw l})};function we(){const t=new Date,e=t.getHours().toString().padStart(2,"0"),o=t.getMinutes().toString().padStart(2,"0");return`${e}:${o}`}function Z(){return"msg_"+Date.now()+"_"+Math.random().toString(36).substr(2,9)}function _e(){const t=document.querySelector(".chat-messages");t&&(t.scrollTop=t.scrollHeight)}const b={BASE_URL:{}.VITE_API_BASE_URL||"http://localhost:8000",ENDPOINTS:{GET_WX_FRIEND_LIST:"/chatpage/getWxListFriendAndMessage",FORWARD_MESSAGE:"/chatpage/forwardMessage",CHAT:"/chatPage/chat",SAVE_SETTINGS:"/mine/setting",LOAD_CHAT_DATA:"/knowledge/loadChatData",CLEAR_CHAT_DATA:"/knowledge/clearChatData",COUNT_TXT_FILES:"/wechat_rag/count_txt",CLEAR_WECHAT_FILES:"/wechat_rag/clear_files"},TIMEOUT:15e3,MAX_RETRIES:3,CORS:{ENABLED:!0,ALLOWED_HEADERS:["Content-Type","Authorization","Accept"],ALLOWED_METHODS:["GET","POST","PUT","DELETE","OPTIONS"]}};console.log("当前为生产环境，API地址:",b.BASE_URL),{}.VITE_API_BASE_URL||(console.warn("警告: 未设置 VITE_API_BASE_URL 环境变量，使用默认地址:",b.BASE_URL),console.warn("建议在生产环境设置正确的后端API地址"));const ne=b.BASE_URL;function Ee(t,e={},o=b.TIMEOUT){return Promise.race([fetch(t,e),new Promise((i,n)=>setTimeout(()=>n(new Error(`请求超时 (${o}ms)`)),o))])}async function M(t,e={},o=0){try{const n={...{Accept:"application/json","Content-Type":"application/json"},...e.headers},l={method:e.method||"GET",headers:n,mode:"cors",credentials:"omit",...e};console.log(`[API请求 ${o+1}/${b.MAX_RETRIES+1}]`,`${ne}${t}`);const a=await Ee(`${ne}${t}`,l,b.TIMEOUT);if(console.log("收到响应:",a.status,a.statusText),!a.ok){const y=await a.text();let h;try{h=JSON.parse(y)}catch{h={message:y||"请求失败"}}throw new Error(`HTTP ${a.status}: ${h.message||a.statusText}`)}const d=await a.json();return console.log("响应数据:",d),d}catch(i){if(console.error(`API请求失败 (重试 ${o+1}/${b.MAX_RETRIES+1}):`,i),o<b.MAX_RETRIES&&(i.message.includes("超时")||i.name==="TypeError"))return console.log(`等待重试... (${o+1}/${b.MAX_RETRIES})`),await new Promise(n=>setTimeout(n,1e3*(o+1))),M(t,e,o+1);throw i.message.includes("超时")?new Error("请求超时，请检查网络连接或后端服务状态"):i.message.includes("fetch")?new Error("网络连接失败，请检查后端服务是否运行"):i.message.includes("CORS")?new Error("跨域请求被阻止，请检查后端CORS配置"):i}}async function le(){var t;try{console.log("开始获取微信好友列表...");const e=await M(b.ENDPOINTS.GET_WX_FRIEND_LIST,{method:"GET"});if(console.log("API响应:",e),e.code===200&&e.status==="success")return console.log("成功获取数据:",e.data.message),e.data.message;throw console.error("API返回错误:",e),new Error(((t=e.data)==null?void 0:t.message)||e.message||"获取数据失败")}catch(e){throw console.error("获取微信好友列表失败:",e),e.name==="TypeError"&&e.message.includes("fetch")?new Error("网络连接失败，请检查后端服务是否运行"):e.message.includes("405")?new Error("后端服务器不支持该请求方法，请检查CORS配置"):e.message.includes("404")?new Error("接口地址不存在，请检查API路径"):e.message.includes("CORS")?new Error("跨域请求被阻止，请检查后端CORS配置"):e}}async function be(t){var e;try{console.log("开始转发消息至微信:",t);const o=await M(b.ENDPOINTS.FORWARD_MESSAGE,{method:"POST",body:JSON.stringify(t)});if(console.log("转发接口响应:",o),o.code===200&&o.status==="success")return console.log("成功转发消息:",o.data),o.data;throw console.error("转发接口返回错误:",o),new Error(((e=o.data)==null?void 0:e.message)||o.message||"转发消息失败")}catch(o){throw console.error("转发消息至微信失败:",o),o}}async function Ae(t,e="default"){var o;try{console.log("开始调用AI聊天接口:",t);const i=e==="default"?"default":e,n=`${b.ENDPOINTS.CHAT}?query=${encodeURIComponent(t)}&contact=${encodeURIComponent(i)}`,l=await M(n,{method:"POST"});if(console.log("AI聊天接口响应:",l),l.code===200)return l.data?l.data:l.message?(console.log("AI回复成功:",l.message),[l.message]):(console.log("AI回复成功:",l),[l]);if(l.message)return console.log("AI回复成功:",l.message),[l.message];if(l.data)return console.log("AI回复成功:",l.data),[l.data];throw console.error("AI聊天接口返回错误:",l),new Error(((o=l.data)==null?void 0:o.message)||l.message||l.error||"AI聊天失败")}catch(i){throw console.error("调用AI聊天接口失败:",i),i}}function te(t){const e=[],o={};return Object.entries(t).forEach(([i,n],l)=>{const a={id:`wx_${l+1}`,name:i,avatar:"👤",status:"online",lastSeen:"刚刚",type:"wechat"};e.push(a);const d=[];n.forEach((y,h)=>{const v=Object.keys(y)[0],S=Object.values(y)[0];d.push({id:`msg_${l}_${h}`,type:v==="self"?"sent":"received",content:S})}),d.length>0&&(o[a.id]=d)}),{contacts:e,messages:o}}function ie(){return console.log("使用模拟数据"),te({张三:[{self:"你好，最近怎么样？"},{friend:"还不错，工作比较忙"},{self:"注意身体，别太累了"}],李四:[{friend:"周末一起吃饭吗？"},{self:"好啊，去哪里？"},{friend:"新开的那家火锅店"}],王五:[{self:"项目进展如何？"},{friend:"按计划进行中"},{self:"辛苦了！"}]})}async function Se(t){var e;try{console.log("开始保存系统设置:",t);const o=await M(b.ENDPOINTS.SAVE_SETTINGS,{method:"POST",body:JSON.stringify(t)});if(console.log("保存设置接口响应:",o),o.code===200&&o.status==="setting_updated")return console.log("成功保存设置:",o.data),{success:!0,message:o.data,data:o.data};throw console.error("保存设置接口返回错误:",o),new Error(((e=o.data)==null?void 0:e.message)||o.message||"保存设置失败")}catch(o){throw console.error("保存系统设置失败:",o),o}}class re{constructor(){this.websocket=null,this.isConnected=!1,this.currentFriend=null,this.onMessageCallback=null,this.onErrorCallback=null}async connect(e,o,i){try{console.log("=== WebSocket连接开始 ==="),console.log("联系人名字:",e),console.log("当前环境:","生产环境"),this.websocket&&(console.log("检测到已有连接，先断开"),this.disconnect());let n;return n=`ws://${b.BASE_URL.replace("http://","")}/ws/auto_reply`,console.log("WebSocket连接地址:",n),console.log("开始创建WebSocket实例..."),this.websocket=new WebSocket(n),this.currentFriend=e,this.onMessageCallback=o,this.onErrorCallback=i,console.log("WebSocket实例已创建，等待连接..."),new Promise((l,a)=>{console.log("设置WebSocket事件监听器..."),this.websocket.onopen=()=>{console.log("✅ WebSocket连接已建立"),console.log("连接状态:",this.websocket.readyState),this.isConnected=!0;const d={friend_name:e};console.log("📤 发送启动指令:",d),console.log("发送的JSON字符串:",JSON.stringify(d));try{this.websocket.send(JSON.stringify(d)),console.log("✅ 启动指令发送成功")}catch(y){console.error("❌ 发送启动指令失败:",y),a(y);return}l(!0)},this.websocket.onmessage=d=>{try{const y=JSON.parse(d.data);console.log("收到WebSocket消息:",y),this.onMessageCallback&&this.onMessageCallback(y)}catch(y){console.error("解析WebSocket消息失败:",y)}},this.websocket.onerror=d=>{console.error("❌ WebSocket连接错误:",d),console.error("错误详情:",{type:d.type,message:d.message,target:d.target}),this.isConnected=!1,this.onErrorCallback&&this.onErrorCallback(d),a(d)},this.websocket.onclose=d=>{console.log("🔌 WebSocket连接已关闭"),console.log("关闭代码:",d.code),console.log("关闭原因:",d.reason),console.log("是否清理:",d.wasClean),this.isConnected=!1,this.currentFriend=null,this.onMessageCallback&&this.onMessageCallback({code:200,status:"disconnected",message:"WebSocket连接已断开"})},console.log("设置5秒连接超时..."),setTimeout(()=>{this.isConnected||(console.error("⏰ WebSocket连接超时"),console.log("当前连接状态:",this.websocket.readyState),console.log("WebSocket状态说明:"),console.log("  0: CONNECTING - 连接中"),console.log("  1: OPEN - 已连接"),console.log("  2: CLOSING - 关闭中"),console.log("  3: CLOSED - 已关闭"),a(new Error("WebSocket连接超时")))},5e3)})}catch(n){throw console.error("连接WebSocket失败:",n),n}}async stopAutoReply(){try{if(this.websocket&&this.isConnected){console.log("发送停止自动回复指令");const e={status:"stopped"};return console.log("发送停止指令:",e),this.websocket.send(JSON.stringify(e)),!0}return!1}catch(e){return console.error("停止自动回复失败:",e),!1}}disconnect(){this.websocket&&(console.log("断开WebSocket连接"),this.websocket.close(),this.websocket=null,this.isConnected=!1,this.currentFriend=null)}getStatus(){return{isConnected:this.isConnected,currentFriend:this.currentFriend}}}const Y=new re;async function Ce(){try{console.log("开始加载聊天数据到知识库...");const t=await M(b.ENDPOINTS.LOAD_CHAT_DATA,{method:"POST"});if(console.log("加载聊天数据接口响应:",t),t.code===200)return console.log("成功加载聊天数据:",t.data),{success:!0,message:t.message||"聊天数据加载成功",data:t.data};throw console.error("加载聊天数据接口返回错误:",t),new Error(t.message||"加载聊天数据失败")}catch(t){throw console.error("加载聊天数据失败:",t),t}}async function De(){try{console.log("开始清空知识库中的聊天数据...");const t=await M(b.ENDPOINTS.CLEAR_CHAT_DATA,{method:"POST"});if(console.log("清空聊天数据接口响应:",t),t.code===200)return console.log("成功清空聊天数据:",t.data),{success:!0,message:t.message||"聊天数据清空成功",data:t.data};throw console.error("清空聊天数据接口返回错误:",t),new Error(t.message||"清空聊天数据失败")}catch(t){throw console.error("清空聊天数据失败:",t),t}}async function Ie(){try{console.log("开始执行微信数据处理流程...");const t=await M(b.ENDPOINTS.COUNT_TXT_FILES,{method:"GET"});if(console.log("微信数据处理接口响应:",t),t.code===200){console.log("成功处理微信数据:",t.data);let e="微信数据处理完成";return t.data&&t.data.message?(e=t.data.message,console.log("提取到message字段:",e)):typeof t.data=="string"?(e=t.data,console.log("response.data是字符串，直接使用:",e)):console.log("未找到message字段，使用默认消息"),{success:!0,message:e,data:t.data}}else throw console.error("微信数据处理接口返回错误:",t),new Error(t.message||"微信数据处理失败")}catch(t){throw console.error("微信数据处理失败:",t),t}}async function ke(){try{console.log("开始清空微信导出文件...");const t=await M(b.ENDPOINTS.CLEAR_WECHAT_FILES,{method:"POST"});if(console.log("清空微信文件接口响应:",t),t.code===200){console.log("成功清空微信文件:",t.data);let e="微信文件清空成功";return t.data&&t.data.message?(e=t.data.message,console.log("提取到message字段:",e)):console.log("未找到message字段，使用默认消息"),{success:!0,message:e,data:t.data}}else throw console.error("清空微信文件接口返回错误:",t),new Error(t.message||"清空微信文件失败")}catch(t){throw console.error("清空微信文件失败:",t),t}}const F=Object.freeze(Object.defineProperty({__proto__:null,AutoReplyManager:re,autoReplyManager:Y,chatWithAI:Ae,clearChatData:De,clearWechatFiles:ke,countTxtFiles:Ie,forwardMessageToWechat:be,getMockWxData:ie,getWxFriendListAndMessages:le,loadChatData:Ce,saveSettings:Se,transformWxData:te},Symbol.toStringTag,{value:"Module"}));function Te(){const t=A("home"),e=A(null),o=A({}),i=A(""),n=A(!1),l=A([]),a=A({}),d=A(!1),y=A(!1),h=A(!1),v=A("");console.log("useChat初始化，activeOption初始值:",t.value);const S=oe(()=>e.value?`与 ${e.value.name} 的对话`:"默认对话"),X=oe(()=>{var r;if(console.log("currentMessageGroups计算，currentContact:",(r=e.value)==null?void 0:r.name),e.value){let u=[];return e.value.type==="wechat"&&a.value[e.value.id]&&(u=[...a.value[e.value.id]],console.log("添加微信历史消息:",u.length,"条")),o.value[e.value.id]&&(u=[...u,...o.value[e.value.id]],console.log("添加本地新消息:",o.value[e.value.id].length,"条")),console.log("合并后的总消息数:",u.length),u}else return o.value.default?(console.log("返回默认对话消息:",o.value.default.length,"条"),o.value.default):(console.log("没有默认对话消息，返回空数组"),[])});function B(r){if(console.log("setActiveOption被调用，从",t.value,"改为",r),console.log("调用栈:",new Error().stack),y.value&&r!=="contacts"){console.log("正在获取联系人中，阻止切换到:",r);return}console.log("允许切换到:",r),t.value=r,r==="default"?(e.value=null,console.log("切换到默认对话，清空currentContact")):r==="contacts"?(e.value=null,console.log("切换到联系人页面，清空当前选中的联系人，重新显示联系人列表")):(e.value=null,console.log("切换到其他页面，清空currentContact")),r==="contacts"&&console.log("选择contacts选项，保持当前加载状态:",n.value),r==="home"&&(i.value=""),console.log("setActiveOption完成，当前选项:",t.value)}function x(r){console.log("选择联系人:",r.name),e.value=r,t.value="contacts",o.value[r.id]||(o.value[r.id]=[]),console.log("选择联系人后，当前activeOption:",t.value)}async function K(r){if(r.trim()){we();const u=Z();let p;if(e.value?(o.value[e.value.id]||(o.value[e.value.id]=[]),p=o.value[e.value.id]):(o.value.default||(o.value.default=[]),p=o.value.default),p){const $={id:u,type:"received",content:r};p.push($);const L=Z(),Q={id:L,type:"sent",content:"正在回复",isWaiting:!0};p.push(Q),e.value?o.value[e.value.id]=[...p]:o.value.default=[...p];try{console.log("调用AI聊天接口:",r);const{chatWithAI:N}=await G(()=>Promise.resolve().then(()=>F),void 0),W=e.value?e.value.name:"default",w=await N(r,W),P=p.findIndex(f=>f.id===L);P!==-1&&p.splice(P,1);let D=[];if(Array.isArray(w))D=w;else if(typeof w=="string")try{const f=JSON.parse(w);Array.isArray(f)?D=f:D=[w]}catch{D=[w]}else typeof w=="object"&&w?Array.isArray(w.data)?D=w.data:Array.isArray(w.message)?D=w.message:Array.isArray(w.content)?D=w.content:w.data?D=[w.data]:w.message?D=[w.message]:D=[JSON.stringify(w)]:D=[String(w)];D.forEach(f=>{let m=String(f).trim();m&&p.push({id:Z(),type:"sent",content:m,isWaiting:!1})}),e.value?o.value[e.value.id]=[...p]:o.value.default=[...p]}catch(N){console.error("AI聊天失败，使用模拟回复:",N);const W=p.findIndex(w=>w.id===L);W!==-1&&(p[W]={id:L,type:"sent",content:"抱歉，AI暂时无法回复，请稍后再试。",isWaiting:!1,isError:!0},e.value?o.value[e.value.id]=[...p]:o.value.default=[...p])}}}}function z(){i.value=""}async function V(){try{console.log("fetchWxFriendList开始，当前activeOption:",t.value),y.value=!0,d.value=!0;try{const r=await le(),{contacts:u,messages:p}=te(r);return l.value=u,a.value=p,n.value=!0,u.length>0&&(x(u[0]),console.log("自动选择第一个联系人:",u[0].name)),console.log("成功获取微信好友列表:",u),console.log("微信消息记录:",p),console.log("获取完成后，当前activeOption:",t.value),{contacts:u,messages:p}}catch(r){console.warn("后端API调用失败，使用模拟数据:",r);const{contacts:u,messages:p}=ie();return l.value=u,a.value=p,n.value=!0,u.length>0&&(x(u[0]),console.log("使用模拟数据，自动选择第一个联系人:",u[0].name)),console.log("使用模拟数据:",u),console.log("模拟数据完成后，当前activeOption:",t.value),{contacts:u,messages:p}}}catch(r){throw console.error("获取微信好友列表失败:",r),r}finally{d.value=!1,y.value=!1,console.log("fetchWxFriendList完成，最终activeOption:",t.value)}}async function se(r){try{console.log("开始启动自动回复:",r),h.value=!0,v.value="正在启动自动回复...",await Y.connect(r,u=>{console.log("收到自动回复消息:",u),u.code===200?u.status==="stopped"?(h.value=!1,v.value="自动回复已停止",console.log("WebSocket通知：自动回复已停止")):u.status==="disconnected"?(h.value=!1,v.value="连接已断开",console.log("WebSocket通知：连接已断开"),window.dispatchEvent&&window.dispatchEvent(new CustomEvent("auto-reply-disconnected"))):(h.value=!0,v.value="自动回复已启动",console.log("WebSocket通知：自动回复已启动")):u.code===400?(h.value=!1,v.value=`参数错误: ${u.message||"未知错误"}`,console.log("WebSocket通知：参数错误")):(h.value=!1,v.value=`启动失败: ${u.message||"未知错误"}`,console.log("WebSocket通知：启动失败"))},u=>{console.error("自动回复连接错误:",u),h.value=!1,v.value=`连接失败: ${u.message||"未知错误"}`}),console.log("自动回复启动成功")}catch(u){throw console.error("启动自动回复失败:",u),h.value=!1,v.value=`启动失败: ${u.message||"未知错误"}`,u}}async function k(){try{console.log("开始停止自动回复"),await Y.stopAutoReply(),h.value=!1,v.value="正在停止自动回复...",console.log("停止自动回复指令已发送，本地状态已更新")}catch(r){throw console.error("停止自动回复失败:",r),h.value=!1,v.value="停止失败",r}}function C(){return{isActive:h.value,status:v.value,currentFriend:Y.getStatus().currentFriend}}return{activeOption:t,currentContact:e,contactMessages:o,newMessage:i,contactsLoaded:n,wxContacts:l,wxMessages:a,isLoadingWxData:d,isGettingContacts:y,isAutoReplyActive:h,autoReplyStatus:v,currentChatTitle:S,currentMessageGroups:X,setActiveOption:B,selectContact:x,sendMessage:K,clearMessageInput:z,fetchWxFriendList:V,startAutoReply:se,stopAutoReply:k,getAutoReplyStatus:C}}const U=(t,e)=>{const o=t.__vccOpts||t;for(const[i,n]of e)o[i]=n;return o},Me={name:"Sidebar",props:{activeOption:{type:String,required:!0},currentContact:{type:Object,default:null},contactsLoaded:{type:Boolean,default:!1},wxContacts:{type:Array,default:()=>[]},isLoadingWxData:{type:Boolean,default:!1}},emits:["option-change","contact-select","get-wx-contacts"],methods:{handleGetContacts(){if(this.isLoadingWxData){console.log("正在获取联系人，忽略重复点击");return}this.$emit("get-wx-contacts")}}},Pe={class:"sidebar"},Oe={class:"sidebar-options"},Re={key:0,class:"loading-spinner"},Le={key:0,class:"contacts-list"},We={key:0,class:"loading-state"},xe={key:1},Ne=["onClick"],Ge={class:"contact-avatar"},Fe={class:"contact-info"},Ue={class:"contact-name"},Be={class:"contact-status"},Ke={key:0,class:"contact-selected-indicator"},Ve={key:2,class:"no-contacts"},He={key:3,class:"initial-state"};function je(t,e,o,i,n,l){return c(),g("div",Pe,[e[12]||(e[12]=s("div",{class:"sidebar-header"},[s("div",{class:"welcome-icon"},"🤖"),s("div",{class:"agent-name"},"Avatar agent")],-1)),s("div",Oe,[s("div",{class:T(["option-item",{active:o.activeOption==="home"}]),onClick:e[0]||(e[0]=a=>t.$emit("option-change","home"))},e[4]||(e[4]=[s("span",{class:"option-icon"},"🏠",-1),s("span",null,"首页",-1)]),2),s("div",{class:T(["option-item",{active:o.activeOption==="settings"}]),onClick:e[1]||(e[1]=a=>t.$emit("option-change","settings"))},e[5]||(e[5]=[s("span",{class:"option-icon"},"⚙️",-1),s("span",null,"我的",-1)]),2),s("div",{class:T(["option-item",{active:o.activeOption==="default"}]),onClick:e[2]||(e[2]=a=>t.$emit("option-change","default"))},e[6]||(e[6]=[s("span",{class:"option-icon"},"💬",-1),s("span",null,"默认对话",-1)]),2),s("div",{class:T(["option-item",{active:o.activeOption==="contacts"||o.currentContact&&o.contactsLoaded,loading:o.isLoadingWxData,disabled:o.isLoadingWxData}]),onClick:e[3]||(e[3]=(...a)=>l.handleGetContacts&&l.handleGetContacts(...a))},[e[7]||(e[7]=s("span",{class:"option-icon"},"👥",-1)),s("span",null,E(o.isLoadingWxData?"获取中...":"获取当前联系人"),1),o.isLoadingWxData?(c(),g("span",Re,"⏳")):I("",!0)],2)]),o.contactsLoaded&&o.wxContacts.length>0?(c(),g("div",Le,[o.isLoadingWxData?(c(),g("div",We,e[8]||(e[8]=[s("div",{class:"loading-spinner-large"},"⏳",-1),s("div",{class:"loading-text"},"正在获取微信联系人...",-1)]))):I("",!0),o.contactsLoaded&&o.wxContacts.length>0?(c(),g("div",xe,[e[9]||(e[9]=s("div",{class:"contacts-header"},"微信联系人",-1)),(c(!0),g(q,null,ee(o.wxContacts,a=>(c(),g("div",{class:T(["contact-item wechat-contact",{selected:o.currentContact&&o.currentContact.id===a.id}]),key:a.id,onClick:d=>t.$emit("contact-select",a)},[s("div",Ge,E(a.avatar),1),s("div",Fe,[s("div",Ue,E(a.name),1),s("div",Be,E(a.status),1),o.currentContact&&o.currentContact.id===a.id?(c(),g("div",Ke," ✓ 当前聊天 ")):I("",!0)])],10,Ne))),128))])):o.contactsLoaded&&o.wxContacts.length===0?(c(),g("div",Ve,e[10]||(e[10]=[s("div",{class:"no-contacts-icon"},"📭",-1),s("div",{class:"no-contacts-text"},"暂无微信联系人",-1)]))):(c(),g("div",He,e[11]||(e[11]=[s("div",{class:"initial-icon"},"👥",-1),s("div",{class:"initial-text"},"点击上方按钮获取微信联系人",-1)])))])):I("",!0)])}const Ye=U(Me,[["render",je],["__scopeId","data-v-4dedcfc3"]]);const qe={name:"HomePage"},Je={class:"home-page"};function Xe(t,e,o,i,n,l){return c(),g("div",Je,e[0]||(e[0]=[ce('<div class="welcome-container" data-v-a0bedc44><div class="welcome-icon-large" data-v-a0bedc44>🤖</div><div class="welcome-title" data-v-a0bedc44>欢迎使用 Avatar agent</div><div class="welcome-subtitle" data-v-a0bedc44>您的分身AI助手</div><div class="welcome-description" data-v-a0bedc44> 选择左侧菜单开始使用，或直接开始对话 </div></div>',1)]))}const ze=U(qe,[["render",Xe],["__scopeId","data-v-a0bedc44"]]);const $e={name:"ChatInterface",props:{chatTitle:{type:String,required:!0},messageGroups:{type:Array,default:()=>[]},currentContact:{type:Object,default:null},autoReplyStatus:{type:Object,default:()=>({isActive:!1,status:""})}},data(){return{newMessage:"",autoReplyEnabled:!1}},emits:["send-message","auto-reply-change","forward-message"],computed:{isDefaultChat(){return this.chatTitle==="默认对话"},syncAutoReplyStatus(){return this.autoReplyStatus.isActive}},watch:{messageGroups:{handler(){this.$nextTick(()=>{this.scrollToBottom()})},deep:!0},syncAutoReplyStatus:{handler(t){console.log("ChatInterface接收到自动回复状态变化:",t),this.autoReplyEnabled=t},immediate:!0}},mounted(){document.addEventListener("keydown",this.handleGlobalKeydown),this.$nextTick(()=>{this.scrollToBottom()})},beforeUnmount(){document.removeEventListener("keydown",this.handleGlobalKeydown)},methods:{sendMessage(){this.newMessage.trim()&&(this.$emit("send-message",this.newMessage),this.newMessage="")},async forwardToWechat(t){try{if(console.log("转发消息至微信:",t.content),!this.currentContact){console.warn("没有选中联系人，无法转发");return}const e=[{[this.currentContact.name]:t.content}],o=await this.$emit("forward-message",e);console.log("转发成功:",o)}catch(e){console.error("转发失败:",e)}},async toggleAutoReply(){try{if(this.autoReplyEnabled)this.autoReplyEnabled=!1,this.$emit("auto-reply-change",!1);else if(this.currentContact)this.autoReplyEnabled=!0,this.$emit("auto-reply-change",!0,this.currentContact.name);else{console.warn("没有选中联系人，无法启动自动回复");return}}catch(t){console.error("切换自动回复状态失败:",t),this.autoReplyEnabled=!1}},scrollToBottom(){this.$nextTick(()=>{const t=this.$refs.messagesContainer;t&&(t.scrollTop=t.scrollHeight)})},disableAutoReply(){this.autoReplyEnabled=!1,this.$emit("auto-reply-change",!1)},handleGlobalKeydown(t){t.key==="F10"&&this.autoReplyEnabled&&this.disableAutoReply()}}},Qe={class:"chat-container"},Ze={class:"chat-header"},et={class:"chat-title"},tt={class:"chat-messages",ref:"messagesContainer"},st={key:0,class:"user-message"},ot={class:"message-content"},at={class:"user-name"},nt={class:"message-bubble user-bubble"},lt={key:1,class:"ai-message"},it=["onClick"],rt={class:"message-content"},ct={key:0,class:"waiting-dots"},dt={key:1},ut={key:1},gt={class:"chat-input"},ht={class:"input-container"},ft={class:"input-area"},vt={class:"input-actions"},mt={class:"auto-reply-icon"},pt={class:"auto-reply-text"};function yt(t,e,o,i,n,l){return c(),g("div",Qe,[s("div",Ze,[s("div",et,E(o.chatTitle),1)]),s("div",tt,[(c(!0),g(q,null,ee(o.messageGroups,a=>(c(),g("div",{class:T(["message",a.type]),key:a.id},[a.type==="received"?(c(),g("div",st,[s("div",ot,[s("div",at,E(o.currentContact?o.currentContact.name:"用户"),1),s("div",nt,E(a.content),1)])])):(c(),g("div",lt,[a.isWaiting?I("",!0):(c(),g("button",{key:0,class:"forward-button",onClick:d=>l.forwardToWechat(a),title:"转发至微信"},e[4]||(e[4]=[s("span",{class:"forward-icon"},"↗",-1)]),8,it)),s("div",rt,[s("div",{class:T(["message-bubble ai-bubble",{waiting:a.isWaiting,error:a.isError}])},[a.isWaiting?(c(),g("span",ct,e[5]||(e[5]=[ue(" 正在回复 ",-1),s("div",{class:"loading-spinner"},null,-1)]))):(c(),g("div",dt,[Array.isArray(a.content)?(c(!0),g(q,{key:0},ee(a.content,(d,y)=>(c(),g("div",{key:y,class:"message-item"},E(typeof d=="object"?d.message||d.content||JSON.stringify(d):d),1))),128)):(c(),g("span",ut,E(a.content),1))]))],2)]),e[6]||(e[6]=s("div",{class:"ai-avatar"},[s("div",{class:"robot-avatar"},"🤖")],-1))]))],2))),128))],512),s("div",gt,[s("div",ht,[s("div",ft,[O(s("textarea",{"onUpdate:modelValue":e[0]||(e[0]=a=>n.newMessage=a),placeholder:"输入消息...",onKeydown:e[1]||(e[1]=de(J((...a)=>l.sendMessage&&l.sendMessage(...a),["prevent"]),["enter"])),ref:"messageInput",rows:"3"},null,544),[[R,n.newMessage]])]),s("div",vt,[l.isDefaultChat?I("",!0):(c(),g("button",{key:0,class:T(["auto-reply-button",{enabled:n.autoReplyEnabled}]),onClick:e[2]||(e[2]=(...a)=>l.toggleAutoReply&&l.toggleAutoReply(...a)),type:"button"},[s("span",mt,E(n.autoReplyEnabled?"🔴":"🟢"),1),s("span",pt,E(n.autoReplyEnabled?"自动回复中":"启用自动回复"),1)],2)),s("button",{class:"send-button",onClick:e[3]||(e[3]=(...a)=>l.sendMessage&&l.sendMessage(...a))},e[7]||(e[7]=[s("span",{class:"send-icon"},"➤",-1),s("span",{class:"send-text"},"发送",-1)]))])])])])}const wt=U($e,[["render",yt],["__scopeId","data-v-d6c10a34"]]);const _t={name:"SettingsPage",props:{wechatDataStatus:{type:Object,required:!0}},data(){return{activeTab:"system",settings:{OPENAI_API_KEY:"",OPENAI_MODEL:"deepseek-chat",OPENAI_API_BASE:"https://api.deepseek.com",REDIS_URL:"redis://localhost:6379",SERPAPI_API_KEY:"",EMBEDDING_MODEL:"moka-ai/m3e-base",BAIDU_API_KEY:""},hiddenSettings:{QDRANT_PATH:"bot/local_qdrand",QDRANT_COLLECTION:"wechat_chat_history"},showModal:!1,modalTitle:"",modalMessage:"",modalType:"message",modalConfirmText:"确定",modalCancelText:"取消",modalResolve:null,isLoadingChatData:!1,isClearingChatData:!1,chatDataStatus:null}},methods:{async saveSettings(){try{if(console.log("开始保存设置:",this.settings),!this.settings.OPENAI_API_KEY||!this.settings.OPENAI_MODEL||!this.settings.OPENAI_API_BASE||!this.settings.REDIS_URL){this.showMessage("验证失败","请填写所有必填字段！");return}const t={};Object.entries(this.settings).forEach(([i,n])=>{n&&n.trim()!==""&&(t[i]=n.trim())}),Object.entries(this.hiddenSettings).forEach(([i,n])=>{t[i]=n}),console.log("过滤后的设置（只包含有值的项）:",t),console.log("包含隐藏配置项:",Object.keys(this.hiddenSettings));const{saveSettings:e}=await G(()=>Promise.resolve().then(()=>F),void 0),o=await e(t);if(o.success){const i=typeof o.message=="string"?o.message:"设置已保存";this.showMessage("保存成功",i),console.log("设置保存成功:",o)}else this.showMessage("保存失败","设置保存失败，请重试")}catch(t){console.error("保存设置失败:",t),this.showMessage("保存失败",`保存设置失败：${t.message}`)}},resetToDefaults(){this.settings={OPENAI_API_KEY:"",OPENAI_MODEL:"deepseek-chat",OPENAI_API_BASE:"https://api.deepseek.com",REDIS_URL:"redis://localhost:6379",SERPAPI_API_KEY:"",EMBEDDING_MODEL:"moka-ai/m3e-base",BAIDU_API_KEY:""}},showMessage(t,e){this.modalTitle=t,this.modalMessage=e,this.modalType="message",this.showModal=!0},closeModal(){this.showModal=!1,this.modalTitle="",this.modalMessage="",this.modalType="message",this.modalConfirmText="确定",this.modalCancelText="取消",this.modalResolve=null},handleModalConfirm(){this.modalResolve&&this.modalResolve(!0),this.closeModal()},handleModalCancel(){this.modalResolve&&this.modalResolve(!1),this.closeModal()},async loadChatData(){this.$emit("wechat-data-processing","load")},async clearChatData(){try{if(!await this.showConfirmDialog("确认清空微信导出文件","确定要清空所有微信导出的CSV和TXT文件吗？此操作不可恢复！","清空","取消"))return;this.$emit("wechat-data-processing","clear")}catch(t){console.error("清空微信导出文件失败:",t)}},showConfirmDialog(t,e,o="确定",i="取消"){return new Promise(n=>{this.modalTitle=t,this.modalMessage=e,this.modalType="confirm",this.modalConfirmText=o,this.modalCancelText=i,this.showModal=!0,this.modalResolve=n})},computed:{wechatDataLoading(){return this.wechatDataStatus.isLoadingChatData},wechatDataProcessing(){return this.wechatDataStatus.isProcessingWechatData},wechatDataStatusMessage(){return this.wechatDataStatus.chatDataStatus},wechatDataClearing(){return this.wechatDataStatus.isClearingChatData}},activated(){console.log("SettingsPage组件被激活，当前状态:",{isLoadingChatData:this.wechatDataStatus.isLoadingChatData,isProcessingWechatData:this.wechatDataStatus.isProcessingWechatData,chatDataStatus:this.wechatDataStatus.chatDataStatus})}}},Et={class:"settings-page"},bt={class:"settings-container"},At={class:"settings-tabs"},St={key:0,class:"tab-content"},Ct={class:"form-section"},Dt={class:"form-group"},It={class:"form-group"},kt={class:"form-group"},Tt={class:"form-group"},Mt={class:"form-section"},Pt={class:"form-group"},Ot={class:"form-group"},Rt={class:"form-group"},Lt={class:"form-actions"},Wt={key:1,class:"tab-content"},xt={class:"knowledge-settings"},Nt={class:"knowledge-actions"},Gt={class:"action-group"},Ft={class:"action-buttons"},Ut=["disabled"],Bt={key:0},Kt={key:1},Vt=["disabled"],Ht={key:0},jt={key:1},Yt={class:"action-status"},qt={key:0,class:"info"},Jt={class:"modal-header"},Xt={class:"modal-body"},zt={class:"modal-footer"};function $t(t,e,o,i,n,l){return c(),g("div",Et,[s("div",bt,[e[38]||(e[38]=s("div",{class:"settings-header"},[s("h1",null,"设置"),s("p",null,"配置系统参数和知识库")],-1)),s("div",At,[s("button",{class:T(["tab-button",{active:n.activeTab==="system"}]),onClick:e[0]||(e[0]=a=>n.activeTab="system")}," 系统设置 ",2),s("button",{class:T(["tab-button",{active:n.activeTab==="knowledge"}]),onClick:e[1]||(e[1]=a=>n.activeTab="knowledge")}," 知识库设置 ",2)]),n.activeTab==="system"?(c(),g("div",St,[s("form",{class:"settings-form",onSubmit:e[10]||(e[10]=J((...a)=>l.saveSettings&&l.saveSettings(...a),["prevent"]))},[s("div",Ct,[e[27]||(e[27]=s("h3",null,"必填配置",-1)),s("div",Dt,[e[19]||(e[19]=s("label",{for:"openai-api-key"},"OPENAI API KEY *",-1)),O(s("input",{id:"openai-api-key","onUpdate:modelValue":e[2]||(e[2]=a=>n.settings.OPENAI_API_KEY=a),type:"password",placeholder:"sk-...",required:""},null,512),[[R,n.settings.OPENAI_API_KEY]]),e[20]||(e[20]=s("small",null,"DeepSeek API密钥，必填",-1))]),s("div",It,[e[21]||(e[21]=s("label",{for:"openai-model"},"OPENAI MODEL *",-1)),O(s("input",{id:"openai-model","onUpdate:modelValue":e[3]||(e[3]=a=>n.settings.OPENAI_MODEL=a),type:"text",placeholder:"deepseek-chat",required:""},null,512),[[R,n.settings.OPENAI_MODEL]]),e[22]||(e[22]=s("small",null,"使用的AI模型名称，必填",-1))]),s("div",kt,[e[23]||(e[23]=s("label",{for:"openai-api-base"},"OPENAI API BASE *",-1)),O(s("input",{id:"openai-api-base","onUpdate:modelValue":e[4]||(e[4]=a=>n.settings.OPENAI_API_BASE=a),type:"url",placeholder:"https://api.deepseek.com",required:""},null,512),[[R,n.settings.OPENAI_API_BASE]]),e[24]||(e[24]=s("small",null,"API基础URL，必填",-1))]),s("div",Tt,[e[25]||(e[25]=s("label",{for:"redis-url"},"REDIS URL *",-1)),O(s("input",{id:"redis-url","onUpdate:modelValue":e[5]||(e[5]=a=>n.settings.REDIS_URL=a),type:"text",placeholder:"redis://localhost:6379",required:""},null,512),[[R,n.settings.REDIS_URL]]),e[26]||(e[26]=s("small",null,"Redis连接地址，必填",-1))])]),s("div",Mt,[e[34]||(e[34]=s("h3",null,"可选配置",-1)),s("div",Pt,[e[28]||(e[28]=s("label",{for:"serpapi-api-key"},"SERPAPI API KEY",-1)),O(s("input",{id:"serpapi-api-key","onUpdate:modelValue":e[6]||(e[6]=a=>n.settings.SERPAPI_API_KEY=a),type:"password",placeholder:"输入SerpAPI密钥..."},null,512),[[R,n.settings.SERPAPI_API_KEY]]),e[29]||(e[29]=s("small",null,"SerpAPI搜索服务密钥",-1))]),s("div",Ot,[e[30]||(e[30]=s("label",{for:"embedding-model"},"EMBEDDING MODEL",-1)),O(s("input",{id:"embedding-model","onUpdate:modelValue":e[7]||(e[7]=a=>n.settings.EMBEDDING_MODEL=a),type:"text",placeholder:"moka-ai/m3e-base"},null,512),[[R,n.settings.EMBEDDING_MODEL]]),e[31]||(e[31]=s("small",null,"文本嵌入模型名称",-1))]),s("div",Rt,[e[32]||(e[32]=s("label",{for:"baidu-api-key"},"BAIDU API KEY",-1)),O(s("input",{id:"baidu-api-key","onUpdate:modelValue":e[8]||(e[8]=a=>n.settings.BAIDU_API_KEY=a),type:"password",placeholder:"输入百度云API密钥..."},null,512),[[R,n.settings.BAIDU_API_KEY]]),e[33]||(e[33]=s("small",null,"百度云API密钥",-1))])]),s("div",Lt,[s("button",{type:"button",class:"btn btn-secondary",onClick:e[9]||(e[9]=(...a)=>l.resetToDefaults&&l.resetToDefaults(...a))}," 重置为默认值 "),e[35]||(e[35]=s("button",{type:"submit",class:"btn btn-primary"}," 保存设置 ",-1))])],32)])):I("",!0),n.activeTab==="knowledge"?(c(),g("div",Wt,[s("div",xt,[e[37]||(e[37]=s("div",{class:"info-box"},[s("div",{class:"info-icon"},"ℹ️"),s("div",{class:"info-content"},[s("h3",null,"使用说明"),s("p",null,"请先在 PyWxDump 界面提取聊天记录，然后在此界面进行知识库操作。")])],-1)),s("div",Nt,[s("div",Gt,[e[36]||(e[36]=s("h3",null,"微信数据处理",-1)),s("div",Ft,[s("button",{class:"btn btn-primary",onClick:e[11]||(e[11]=(...a)=>l.loadChatData&&l.loadChatData(...a)),disabled:t.wechatDataLoading||t.wechatDataProcessing},[t.wechatDataLoading?(c(),g("span",Bt,"处理中...")):(c(),g("span",Kt,"执行微信数据处理"))],8,Ut),s("button",{class:"btn btn-danger",onClick:e[12]||(e[12]=(...a)=>l.clearChatData&&l.clearChatData(...a)),disabled:t.wechatDataClearing},[t.wechatDataClearing?(c(),g("span",Ht,"清空中...")):(c(),g("span",jt,"清空微信导出文件"))],8,Vt)]),s("div",Yt,[t.wechatDataLoading?(c(),g("p",qt," ⏳ 正在执行微信数据处理，请耐心等待... ")):t.wechatDataStatusMessage?(c(),g("p",{key:1,class:T(t.wechatDataStatusMessage.type)},E(t.wechatDataStatusMessage.message),3)):I("",!0)])])])])])):I("",!0)]),n.showModal?(c(),g("div",{key:0,class:"modal-overlay",onClick:e[18]||(e[18]=(...a)=>l.closeModal&&l.closeModal(...a))},[s("div",{class:"modal-content",onClick:e[17]||(e[17]=J(()=>{},["stop"]))},[s("div",Jt,[s("h3",null,E(n.modalTitle),1),s("button",{class:"modal-close",onClick:e[13]||(e[13]=(...a)=>l.closeModal&&l.closeModal(...a))},"×")]),s("div",Xt,[s("p",null,E(n.modalMessage),1)]),s("div",zt,[n.modalType==="confirm"?(c(),g(q,{key:0},[s("button",{class:"modal-btn modal-btn-secondary",onClick:e[14]||(e[14]=(...a)=>l.handleModalCancel&&l.handleModalCancel(...a))},E(n.modalCancelText),1),s("button",{class:"modal-btn modal-btn-primary",onClick:e[15]||(e[15]=(...a)=>l.handleModalConfirm&&l.handleModalConfirm(...a))},E(n.modalConfirmText),1)],64)):(c(),g("button",{key:1,class:"modal-btn modal-btn-primary",onClick:e[16]||(e[16]=(...a)=>l.closeModal&&l.closeModal(...a))}," 确定 "))])])])):I("",!0)])}const Qt=U(_t,[["render",$t],["__scopeId","data-v-cd421a23"]]);const Zt={name:"App",components:{Sidebar:Ye,HomePage:ze,ChatInterface:wt,SettingsPage:Qt},setup(){const{activeOption:t,currentContact:e,contactMessages:o,newMessage:i,contactsLoaded:n,currentChatTitle:l,currentMessageGroups:a,wxContacts:d,wxMessages:y,isLoadingWxData:h,isGettingContacts:v,setActiveOption:S,selectContact:X,sendMessage:B,clearMessageInput:x,fetchWxFriendList:K,startAutoReply:z,stopAutoReply:V,getAutoReplyStatus:se}=Te(),k=A(!1),C=A(null),r=A({isLoadingChatData:!1,isProcessingWechatData:!1,isClearingChatData:!1,chatDataStatus:null}),u=A({show:!1,title:"",message:"",type:"message"});ge(()=>{console.log("App组件挂载完成，初始状态:"),console.log("- activeOption:",t.value),console.log("- currentContact:",e.value),console.log("- contactsLoaded:",n.value),he(()=>{_e()}),window.addEventListener("auto-reply-disconnected",()=>{console.log("收到WebSocket断开事件，解除封锁状态"),k.value=!1,C.value&&(C.value.autoReplyEnabled=!1)});const f=m=>{k.value&&(m.key==="F10"||m.key==="Escape")&&(console.log("全局键盘事件：",m.key,"被按下"),m.preventDefault(),p())};window.addEventListener("keydown",f),console.log("全局键盘事件监听器已添加"),fe(()=>{window.removeEventListener("keydown",f),console.log("全局键盘事件监听器已清理")})});const p=async()=>{try{console.log("F10/ESC按键被按下，停止自动回复"),await V(),k.value=!1,C.value&&(C.value.autoReplyEnabled=!1),console.log("通过F10/ESC成功停止自动回复")}catch(f){console.error("通过F10/ESC停止自动回复失败:",f),k.value=!1,C.value&&(C.value.autoReplyEnabled=!1)}},$=()=>{k.value=!1,C.value&&(C.value.autoReplyEnabled=!1)},L=async(f,m)=>{try{console.log("=== 自动回复状态变化 ==="),console.log("enabled:",f),console.log("friendName:",m),console.log("当前autoReplyEnabled状态:",k.value),f&&m?(console.log("🟢 准备启动自动回复:",m),console.log("调用startAutoReply方法..."),await z(m),console.log("✅ 自动回复启动成功，设置封锁状态"),k.value=!0):(console.log("🔴 准备停止自动回复"),console.log("调用stopAutoReply方法..."),await V(),console.log("✅ 自动回复停止成功，解除封锁状态"),k.value=!1),console.log("=== 自动回复状态变化完成 ===")}catch(_){console.error("❌ 处理自动回复状态变化失败:",_),k.value=!1,C.value&&(C.value.autoReplyEnabled=!1)}},Q=async f=>{try{console.log("处理转发消息:",f);const{forwardMessageToWechat:m}=await G(()=>Promise.resolve().then(()=>F),void 0),_=await m(f);console.log("转发成功，返回结果:",_)}catch(m){console.error("转发消息失败:",m)}},N=async f=>{try{console.log("处理发送消息:",f),await B(f)}catch(m){console.error("发送消息失败:",m)}},W=async()=>{try{console.log("开始获取微信联系人，当前选项:",t.value),console.log("当前contactsLoaded状态:",n.value),S("contacts"),console.log("设置选项为contacts后，当前选项:",t.value),await K(),t.value!=="contacts"&&(console.warn("activeOption被意外重置，重新设置为contacts"),S("contacts")),setTimeout(()=>{t.value!=="contacts"&&(console.warn("延迟检查发现activeOption被重置，重新设置为contacts"),S("contacts")),console.log("延迟检查后，activeOption:",t.value,"contactsLoaded:",n.value)},100),console.log("成功获取微信联系人，当前选项:",t.value,"contactsLoaded:",n.value)}catch(f){console.error("获取微信联系人失败:",f)}},w=async f=>{try{if(f==="load"){if(r.value.isProcessingWechatData){console.log("微信数据处理正在进行中，忽略重复点击");return}r.value.isProcessingWechatData=!0,r.value.isLoadingChatData=!0,r.value.chatDataStatus=null,console.log("开始执行微信数据处理流程...");const{countTxtFiles:m}=await G(()=>Promise.resolve().then(()=>F),void 0),_=await m();_.success?(r.value.chatDataStatus={type:"success",message:_.message||"微信数据处理完成"},P("处理成功",_.message||"微信数据处理完成")):(r.value.chatDataStatus={type:"error",message:_.message||"微信数据处理失败"},P("处理失败",_.message||"微信数据处理失败"))}else if(f==="clear"){r.value.isClearingChatData=!0,r.value.chatDataStatus=null,console.log("开始清空微信导出文件...");const{clearWechatFiles:m}=await G(()=>Promise.resolve().then(()=>F),void 0),_=await m();console.log("=== App.vue中收到的result ==="),console.log("result =",_),console.log("result.message =",_.message),console.log("typeof result.message =",typeof _.message),_.success?(r.value.chatDataStatus={type:"success",message:_.message||"微信导出文件清空成功！"},console.log("准备显示弹窗，消息内容 =",_.message||"微信导出文件已成功清空"),P("清空成功",_.message||"微信导出文件已成功清空")):(r.value.chatDataStatus={type:"error",message:_.message||"微信导出文件清空失败"},P("清空失败",_.message||"微信导出文件清空失败"))}}catch(m){console.error("微信数据处理失败:",m),r.value.chatDataStatus={type:"error",message:`处理失败：${m.message}`},P("处理失败",`微信数据处理失败：${m.message}`)}finally{f==="load"?(r.value.isLoadingChatData=!1,r.value.isProcessingWechatData=!1):f==="clear"&&(r.value.isClearingChatData=!1)}},P=(f,m)=>{u.value={show:!0,title:f,message:m,type:"message"}};return{activeOption:t,currentContact:e,contactMessages:o,newMessage:i,contactsLoaded:n,autoReplyEnabled:k,chatInterface:C,wxContacts:d,wxMessages:y,isLoadingWxData:h,isGettingContacts:v,wechatDataStatus:r,globalModal:u,currentChatTitle:l,currentMessageGroups:a,setActiveOption:S,selectContact:X,sendMessage:B,clearMessageInput:x,disableAutoReply:$,handleAutoReplyChange:L,handleForwardMessage:Q,handleSendMessage:N,fetchWxFriendList:K,handleGetWxContacts:W,handleF10StopAutoReply:p,handleWechatDataProcessing:w,closeGlobalModal:()=>{u.value.show=!1}}}},es={class:"app-container"},ts={class:"content-area"},ss={key:0,class:"global-auto-reply-overlay"},os={class:"auto-reply-message"},as={class:"auto-reply-text-large"},ns={key:1,class:"wechat-processing-overlay"},ls={class:"global-modal-header"},is={class:"global-modal-body"},rs={class:"global-modal-footer"};function cs(t,e,o,i,n,l){const a=H("Sidebar"),d=H("HomePage"),y=H("SettingsPage"),h=H("ChatInterface");return c(),g("div",es,[ve(a,{"active-option":i.activeOption,"current-contact":i.currentContact,"contacts-loaded":i.contactsLoaded,"wx-contacts":i.wxContacts,"is-loading-wx-data":i.isLoadingWxData,onOptionChange:i.setActiveOption,onContactSelect:i.selectContact,onGetWxContacts:i.handleGetWxContacts},null,8,["active-option","current-contact","contacts-loaded","wx-contacts","is-loading-wx-data","onOptionChange","onContactSelect","onGetWxContacts"]),s("div",ts,[i.activeOption==="home"?(c(),j(d,{key:0})):i.activeOption==="settings"?(c(),j(y,{key:1,"wechat-data-status":i.wechatDataStatus,onWechatDataProcessing:i.handleWechatDataProcessing},null,8,["wechat-data-status","onWechatDataProcessing"])):i.currentContact?(c(),j(h,{key:2,"chat-title":i.currentChatTitle,"message-groups":i.currentMessageGroups,"current-contact":i.currentContact,"auto-reply-status":{isActive:i.autoReplyEnabled,status:""},onSendMessage:i.handleSendMessage,onAutoReplyChange:i.handleAutoReplyChange,onForwardMessage:i.handleForwardMessage,ref:"chatInterface"},null,8,["chat-title","message-groups","current-contact","auto-reply-status","onSendMessage","onAutoReplyChange","onForwardMessage"])):(c(),j(h,{key:3,"chat-title":"默认对话","message-groups":i.currentMessageGroups,"current-contact":null,"auto-reply-status":{isActive:i.autoReplyEnabled,status:""},onSendMessage:i.handleSendMessage,onAutoReplyChange:i.handleAutoReplyChange,onForwardMessage:i.handleForwardMessage,ref:"chatInterface"},null,8,["message-groups","auto-reply-status","onSendMessage","onAutoReplyChange","onForwardMessage"]))]),i.autoReplyEnabled?(c(),g("div",ss,[s("div",os,[e[4]||(e[4]=s("div",{class:"auto-reply-icon-large"},"🤖",-1)),s("div",as," 自动回复"+E(i.currentContact&&i.currentContact.name?i.currentContact.name:"联系人")+"中...... ",1),e[5]||(e[5]=s("div",{class:"auto-reply-hint"},"(F10 或 ESC 取消)",-1))])])):I("",!0),i.wechatDataStatus.isLoadingChatData||i.wechatDataStatus.isProcessingWechatData?(c(),g("div",ns,e[6]||(e[6]=[s("div",{class:"wechat-processing-message"},[s("div",{class:"wechat-processing-icon"},"📊"),s("div",{class:"wechat-processing-text"}," 正在执行微信数据处理，请耐心等待... "),s("div",{class:"wechat-processing-spinner"},"⏳")],-1)]))):I("",!0),i.globalModal.show?(c(),g("div",{key:2,class:"global-modal-overlay",onClick:e[3]||(e[3]=(...v)=>i.closeGlobalModal&&i.closeGlobalModal(...v))},[s("div",{class:"global-modal-content",onClick:e[2]||(e[2]=J(()=>{},["stop"]))},[s("div",ls,[s("h3",null,E(i.globalModal.title),1),s("button",{class:"global-modal-close",onClick:e[0]||(e[0]=(...v)=>i.closeGlobalModal&&i.closeGlobalModal(...v))},"×")]),s("div",is,[s("p",null,E(i.globalModal.message),1)]),s("div",rs,[s("button",{class:"global-modal-btn global-modal-btn-primary",onClick:e[1]||(e[1]=(...v)=>i.closeGlobalModal&&i.closeGlobalModal(...v))}," 确定 ")])])])):I("",!0)])}const ds=U(Zt,[["render",cs],["__scopeId","data-v-a19e2d70"]]);me(ds).mount("#app");
