import{r as A,c as oe,o as c,a as g,b as s,n as T,t as E,d as I,F as q,e as ee,f as ce,w as O,v as R,g as de,h as J,i as ue,j as ge,k as he,l as fe,m as H,p as ve,q as j,s as me}from"./vendor-2cf3039e.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))i(n);new MutationObserver(n=>{for(const l of n)if(l.type==="childList")for(const a of l.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&i(a)}).observe(document,{childList:!0,subtree:!0});function o(n){const l={};return n.integrity&&(l.integrity=n.integrity),n.referrerPolicy&&(l.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?l.credentials="include":n.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function i(n){if(n.ep)return;n.ep=!0;const l=o(n);fetch(n.href,l)}})();const pe="modulepreload",ye=function(t){return"/"+t},ae={},G=function(e,o,i){if(!o||o.length===0)return e();const n=document.getElementsByTagName("link");return Promise.all(o.map(l=>{if(l=ye(l),l in ae)return;ae[l]=!0;const a=l.endsWith(".css"),d=a?'[rel="stylesheet"]':"";if(!!i)for(let v=n.length-1;v>=0;v--){const S=n[v];if(S.href===l&&(!a||S.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${l}"]${d}`))return;const h=document.createElement("link");if(h.rel=a?"stylesheet":pe,a||(h.as="script",h.crossOrigin=""),h.href=l,document.head.appendChild(h),a)return new Promise((v,S)=>{h.addEventListener("load",v),h.addEventListener("error",()=>S(new Error(`Unable to preload CSS for ${l}`)))})})).then(()=>e()).catch(l=>{const a=new Event("vite:preloadError",{cancelable:!0});if(a.payload=l,window.dispatchEvent(a),!a.defaultPrevented)throw l})};function we(){const t=new Date,e=t.getHours().toString().padStart(2,"0"),o=t.getMinutes().toString().padStart(2,"0");return`${e}:${o}`}function Z(){return"msg_"+Date.now()+"_"+Math.random().toString(36).substr(2,9)}function _e(){const t=document.querySelector(".chat-messages");t&&(t.scrollTop=t.scrollHeight)}const b={BASE_URL:{}.VITE_API_BASE_URL||"http://localhost:8000",ENDPOINTS:{GET_WX_FRIEND_LIST:"/chatpage/getWxListFriendAndMessage",FORWARD_MESSAGE:"/chatpage/forwardMessage",CHAT:"/chatPage/chat",SAVE_SETTINGS:"/mine/setting",LOAD_CHAT_DATA:"/knowledge/loadChatData",CLEAR_CHAT_DATA:"/knowledge/clearChatData",COUNT_TXT_FILES:"/wechat_rag/count_txt",CLEAR_WECHAT_FILES:"/wechat_rag/clear_files"},TIMEOUT:15e3,MAX_RETRIES:3,CORS:{ENABLED:!0,ALLOWED_HEADERS:["Content-Type","Authorization","Accept"],ALLOWED_METHODS:["GET","POST","PUT","DELETE","OPTIONS"]}};console.log("å½“å‰ä¸ºç”Ÿäº§ç¯å¢ƒï¼ŒAPIåœ°å€:",b.BASE_URL),{}.VITE_API_BASE_URL||(console.warn("è­¦å‘Š: æœªè®¾ç½® VITE_API_BASE_URL ç¯å¢ƒå˜é‡ï¼Œä½¿ç”¨é»˜è®¤åœ°å€:",b.BASE_URL),console.warn("å»ºè®®åœ¨ç”Ÿäº§ç¯å¢ƒè®¾ç½®æ­£ç¡®çš„åç«¯APIåœ°å€"));const ne=b.BASE_URL;function Ee(t,e={},o=b.TIMEOUT){return Promise.race([fetch(t,e),new Promise((i,n)=>setTimeout(()=>n(new Error(`è¯·æ±‚è¶…æ—¶ (${o}ms)`)),o))])}async function M(t,e={},o=0){try{const n={...{Accept:"application/json","Content-Type":"application/json"},...e.headers},l={method:e.method||"GET",headers:n,mode:"cors",credentials:"omit",...e};console.log(`[APIè¯·æ±‚ ${o+1}/${b.MAX_RETRIES+1}]`,`${ne}${t}`);const a=await Ee(`${ne}${t}`,l,b.TIMEOUT);if(console.log("æ”¶åˆ°å“åº”:",a.status,a.statusText),!a.ok){const y=await a.text();let h;try{h=JSON.parse(y)}catch{h={message:y||"è¯·æ±‚å¤±è´¥"}}throw new Error(`HTTP ${a.status}: ${h.message||a.statusText}`)}const d=await a.json();return console.log("å“åº”æ•°æ®:",d),d}catch(i){if(console.error(`APIè¯·æ±‚å¤±è´¥ (é‡è¯• ${o+1}/${b.MAX_RETRIES+1}):`,i),o<b.MAX_RETRIES&&(i.message.includes("è¶…æ—¶")||i.name==="TypeError"))return console.log(`ç­‰å¾…é‡è¯•... (${o+1}/${b.MAX_RETRIES})`),await new Promise(n=>setTimeout(n,1e3*(o+1))),M(t,e,o+1);throw i.message.includes("è¶…æ—¶")?new Error("è¯·æ±‚è¶…æ—¶ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥æˆ–åç«¯æœåŠ¡çŠ¶æ€"):i.message.includes("fetch")?new Error("ç½‘ç»œè¿æ¥å¤±è´¥ï¼Œè¯·æ£€æŸ¥åç«¯æœåŠ¡æ˜¯å¦è¿è¡Œ"):i.message.includes("CORS")?new Error("è·¨åŸŸè¯·æ±‚è¢«é˜»æ­¢ï¼Œè¯·æ£€æŸ¥åç«¯CORSé…ç½®"):i}}async function le(){var t;try{console.log("å¼€å§‹è·å–å¾®ä¿¡å¥½å‹åˆ—è¡¨...");const e=await M(b.ENDPOINTS.GET_WX_FRIEND_LIST,{method:"GET"});if(console.log("APIå“åº”:",e),e.code===200&&e.status==="success")return console.log("æˆåŠŸè·å–æ•°æ®:",e.data.message),e.data.message;throw console.error("APIè¿”å›é”™è¯¯:",e),new Error(((t=e.data)==null?void 0:t.message)||e.message||"è·å–æ•°æ®å¤±è´¥")}catch(e){throw console.error("è·å–å¾®ä¿¡å¥½å‹åˆ—è¡¨å¤±è´¥:",e),e.name==="TypeError"&&e.message.includes("fetch")?new Error("ç½‘ç»œè¿æ¥å¤±è´¥ï¼Œè¯·æ£€æŸ¥åç«¯æœåŠ¡æ˜¯å¦è¿è¡Œ"):e.message.includes("405")?new Error("åç«¯æœåŠ¡å™¨ä¸æ”¯æŒè¯¥è¯·æ±‚æ–¹æ³•ï¼Œè¯·æ£€æŸ¥CORSé…ç½®"):e.message.includes("404")?new Error("æ¥å£åœ°å€ä¸å­˜åœ¨ï¼Œè¯·æ£€æŸ¥APIè·¯å¾„"):e.message.includes("CORS")?new Error("è·¨åŸŸè¯·æ±‚è¢«é˜»æ­¢ï¼Œè¯·æ£€æŸ¥åç«¯CORSé…ç½®"):e}}async function be(t){var e;try{console.log("å¼€å§‹è½¬å‘æ¶ˆæ¯è‡³å¾®ä¿¡:",t);const o=await M(b.ENDPOINTS.FORWARD_MESSAGE,{method:"POST",body:JSON.stringify(t)});if(console.log("è½¬å‘æ¥å£å“åº”:",o),o.code===200&&o.status==="success")return console.log("æˆåŠŸè½¬å‘æ¶ˆæ¯:",o.data),o.data;throw console.error("è½¬å‘æ¥å£è¿”å›é”™è¯¯:",o),new Error(((e=o.data)==null?void 0:e.message)||o.message||"è½¬å‘æ¶ˆæ¯å¤±è´¥")}catch(o){throw console.error("è½¬å‘æ¶ˆæ¯è‡³å¾®ä¿¡å¤±è´¥:",o),o}}async function Ae(t,e="default"){var o;try{console.log("å¼€å§‹è°ƒç”¨AIèŠå¤©æ¥å£:",t);const i=e==="default"?"default":e,n=`${b.ENDPOINTS.CHAT}?query=${encodeURIComponent(t)}&contact=${encodeURIComponent(i)}`,l=await M(n,{method:"POST"});if(console.log("AIèŠå¤©æ¥å£å“åº”:",l),l.code===200)return l.data?l.data:l.message?(console.log("AIå›å¤æˆåŠŸ:",l.message),[l.message]):(console.log("AIå›å¤æˆåŠŸ:",l),[l]);if(l.message)return console.log("AIå›å¤æˆåŠŸ:",l.message),[l.message];if(l.data)return console.log("AIå›å¤æˆåŠŸ:",l.data),[l.data];throw console.error("AIèŠå¤©æ¥å£è¿”å›é”™è¯¯:",l),new Error(((o=l.data)==null?void 0:o.message)||l.message||l.error||"AIèŠå¤©å¤±è´¥")}catch(i){throw console.error("è°ƒç”¨AIèŠå¤©æ¥å£å¤±è´¥:",i),i}}function te(t){const e=[],o={};return Object.entries(t).forEach(([i,n],l)=>{const a={id:`wx_${l+1}`,name:i,avatar:"ğŸ‘¤",status:"online",lastSeen:"åˆšåˆš",type:"wechat"};e.push(a);const d=[];n.forEach((y,h)=>{const v=Object.keys(y)[0],S=Object.values(y)[0];d.push({id:`msg_${l}_${h}`,type:v==="self"?"sent":"received",content:S})}),d.length>0&&(o[a.id]=d)}),{contacts:e,messages:o}}function ie(){return console.log("ä½¿ç”¨æ¨¡æ‹Ÿæ•°æ®"),te({å¼ ä¸‰:[{self:"ä½ å¥½ï¼Œæœ€è¿‘æ€ä¹ˆæ ·ï¼Ÿ"},{friend:"è¿˜ä¸é”™ï¼Œå·¥ä½œæ¯”è¾ƒå¿™"},{self:"æ³¨æ„èº«ä½“ï¼Œåˆ«å¤ªç´¯äº†"}],æå››:[{friend:"å‘¨æœ«ä¸€èµ·åƒé¥­å—ï¼Ÿ"},{self:"å¥½å•Šï¼Œå»å“ªé‡Œï¼Ÿ"},{friend:"æ–°å¼€çš„é‚£å®¶ç«é”…åº—"}],ç‹äº”:[{self:"é¡¹ç›®è¿›å±•å¦‚ä½•ï¼Ÿ"},{friend:"æŒ‰è®¡åˆ’è¿›è¡Œä¸­"},{self:"è¾›è‹¦äº†ï¼"}]})}async function Se(t){var e;try{console.log("å¼€å§‹ä¿å­˜ç³»ç»Ÿè®¾ç½®:",t);const o=await M(b.ENDPOINTS.SAVE_SETTINGS,{method:"POST",body:JSON.stringify(t)});if(console.log("ä¿å­˜è®¾ç½®æ¥å£å“åº”:",o),o.code===200&&o.status==="setting_updated")return console.log("æˆåŠŸä¿å­˜è®¾ç½®:",o.data),{success:!0,message:o.data,data:o.data};throw console.error("ä¿å­˜è®¾ç½®æ¥å£è¿”å›é”™è¯¯:",o),new Error(((e=o.data)==null?void 0:e.message)||o.message||"ä¿å­˜è®¾ç½®å¤±è´¥")}catch(o){throw console.error("ä¿å­˜ç³»ç»Ÿè®¾ç½®å¤±è´¥:",o),o}}class re{constructor(){this.websocket=null,this.isConnected=!1,this.currentFriend=null,this.onMessageCallback=null,this.onErrorCallback=null}async connect(e,o,i){try{console.log("=== WebSocketè¿æ¥å¼€å§‹ ==="),console.log("è”ç³»äººåå­—:",e),console.log("å½“å‰ç¯å¢ƒ:","ç”Ÿäº§ç¯å¢ƒ"),this.websocket&&(console.log("æ£€æµ‹åˆ°å·²æœ‰è¿æ¥ï¼Œå…ˆæ–­å¼€"),this.disconnect());let n;return n=`ws://${b.BASE_URL.replace("http://","")}/ws/auto_reply`,console.log("WebSocketè¿æ¥åœ°å€:",n),console.log("å¼€å§‹åˆ›å»ºWebSocketå®ä¾‹..."),this.websocket=new WebSocket(n),this.currentFriend=e,this.onMessageCallback=o,this.onErrorCallback=i,console.log("WebSocketå®ä¾‹å·²åˆ›å»ºï¼Œç­‰å¾…è¿æ¥..."),new Promise((l,a)=>{console.log("è®¾ç½®WebSocketäº‹ä»¶ç›‘å¬å™¨..."),this.websocket.onopen=()=>{console.log("âœ… WebSocketè¿æ¥å·²å»ºç«‹"),console.log("è¿æ¥çŠ¶æ€:",this.websocket.readyState),this.isConnected=!0;const d={friend_name:e};console.log("ğŸ“¤ å‘é€å¯åŠ¨æŒ‡ä»¤:",d),console.log("å‘é€çš„JSONå­—ç¬¦ä¸²:",JSON.stringify(d));try{this.websocket.send(JSON.stringify(d)),console.log("âœ… å¯åŠ¨æŒ‡ä»¤å‘é€æˆåŠŸ")}catch(y){console.error("âŒ å‘é€å¯åŠ¨æŒ‡ä»¤å¤±è´¥:",y),a(y);return}l(!0)},this.websocket.onmessage=d=>{try{const y=JSON.parse(d.data);console.log("æ”¶åˆ°WebSocketæ¶ˆæ¯:",y),this.onMessageCallback&&this.onMessageCallback(y)}catch(y){console.error("è§£æWebSocketæ¶ˆæ¯å¤±è´¥:",y)}},this.websocket.onerror=d=>{console.error("âŒ WebSocketè¿æ¥é”™è¯¯:",d),console.error("é”™è¯¯è¯¦æƒ…:",{type:d.type,message:d.message,target:d.target}),this.isConnected=!1,this.onErrorCallback&&this.onErrorCallback(d),a(d)},this.websocket.onclose=d=>{console.log("ğŸ”Œ WebSocketè¿æ¥å·²å…³é—­"),console.log("å…³é—­ä»£ç :",d.code),console.log("å…³é—­åŸå› :",d.reason),console.log("æ˜¯å¦æ¸…ç†:",d.wasClean),this.isConnected=!1,this.currentFriend=null,this.onMessageCallback&&this.onMessageCallback({code:200,status:"disconnected",message:"WebSocketè¿æ¥å·²æ–­å¼€"})},console.log("è®¾ç½®5ç§’è¿æ¥è¶…æ—¶..."),setTimeout(()=>{this.isConnected||(console.error("â° WebSocketè¿æ¥è¶…æ—¶"),console.log("å½“å‰è¿æ¥çŠ¶æ€:",this.websocket.readyState),console.log("WebSocketçŠ¶æ€è¯´æ˜:"),console.log("  0: CONNECTING - è¿æ¥ä¸­"),console.log("  1: OPEN - å·²è¿æ¥"),console.log("  2: CLOSING - å…³é—­ä¸­"),console.log("  3: CLOSED - å·²å…³é—­"),a(new Error("WebSocketè¿æ¥è¶…æ—¶")))},5e3)})}catch(n){throw console.error("è¿æ¥WebSocketå¤±è´¥:",n),n}}async stopAutoReply(){try{if(this.websocket&&this.isConnected){console.log("å‘é€åœæ­¢è‡ªåŠ¨å›å¤æŒ‡ä»¤");const e={status:"stopped"};return console.log("å‘é€åœæ­¢æŒ‡ä»¤:",e),this.websocket.send(JSON.stringify(e)),!0}return!1}catch(e){return console.error("åœæ­¢è‡ªåŠ¨å›å¤å¤±è´¥:",e),!1}}disconnect(){this.websocket&&(console.log("æ–­å¼€WebSocketè¿æ¥"),this.websocket.close(),this.websocket=null,this.isConnected=!1,this.currentFriend=null)}getStatus(){return{isConnected:this.isConnected,currentFriend:this.currentFriend}}}const Y=new re;async function Ce(){try{console.log("å¼€å§‹åŠ è½½èŠå¤©æ•°æ®åˆ°çŸ¥è¯†åº“...");const t=await M(b.ENDPOINTS.LOAD_CHAT_DATA,{method:"POST"});if(console.log("åŠ è½½èŠå¤©æ•°æ®æ¥å£å“åº”:",t),t.code===200)return console.log("æˆåŠŸåŠ è½½èŠå¤©æ•°æ®:",t.data),{success:!0,message:t.message||"èŠå¤©æ•°æ®åŠ è½½æˆåŠŸ",data:t.data};throw console.error("åŠ è½½èŠå¤©æ•°æ®æ¥å£è¿”å›é”™è¯¯:",t),new Error(t.message||"åŠ è½½èŠå¤©æ•°æ®å¤±è´¥")}catch(t){throw console.error("åŠ è½½èŠå¤©æ•°æ®å¤±è´¥:",t),t}}async function De(){try{console.log("å¼€å§‹æ¸…ç©ºçŸ¥è¯†åº“ä¸­çš„èŠå¤©æ•°æ®...");const t=await M(b.ENDPOINTS.CLEAR_CHAT_DATA,{method:"POST"});if(console.log("æ¸…ç©ºèŠå¤©æ•°æ®æ¥å£å“åº”:",t),t.code===200)return console.log("æˆåŠŸæ¸…ç©ºèŠå¤©æ•°æ®:",t.data),{success:!0,message:t.message||"èŠå¤©æ•°æ®æ¸…ç©ºæˆåŠŸ",data:t.data};throw console.error("æ¸…ç©ºèŠå¤©æ•°æ®æ¥å£è¿”å›é”™è¯¯:",t),new Error(t.message||"æ¸…ç©ºèŠå¤©æ•°æ®å¤±è´¥")}catch(t){throw console.error("æ¸…ç©ºèŠå¤©æ•°æ®å¤±è´¥:",t),t}}async function Ie(){try{console.log("å¼€å§‹æ‰§è¡Œå¾®ä¿¡æ•°æ®å¤„ç†æµç¨‹...");const t=await M(b.ENDPOINTS.COUNT_TXT_FILES,{method:"GET"});if(console.log("å¾®ä¿¡æ•°æ®å¤„ç†æ¥å£å“åº”:",t),t.code===200){console.log("æˆåŠŸå¤„ç†å¾®ä¿¡æ•°æ®:",t.data);let e="å¾®ä¿¡æ•°æ®å¤„ç†å®Œæˆ";return t.data&&t.data.message?(e=t.data.message,console.log("æå–åˆ°messageå­—æ®µ:",e)):typeof t.data=="string"?(e=t.data,console.log("response.dataæ˜¯å­—ç¬¦ä¸²ï¼Œç›´æ¥ä½¿ç”¨:",e)):console.log("æœªæ‰¾åˆ°messageå­—æ®µï¼Œä½¿ç”¨é»˜è®¤æ¶ˆæ¯"),{success:!0,message:e,data:t.data}}else throw console.error("å¾®ä¿¡æ•°æ®å¤„ç†æ¥å£è¿”å›é”™è¯¯:",t),new Error(t.message||"å¾®ä¿¡æ•°æ®å¤„ç†å¤±è´¥")}catch(t){throw console.error("å¾®ä¿¡æ•°æ®å¤„ç†å¤±è´¥:",t),t}}async function ke(){try{console.log("å¼€å§‹æ¸…ç©ºå¾®ä¿¡å¯¼å‡ºæ–‡ä»¶...");const t=await M(b.ENDPOINTS.CLEAR_WECHAT_FILES,{method:"POST"});if(console.log("æ¸…ç©ºå¾®ä¿¡æ–‡ä»¶æ¥å£å“åº”:",t),t.code===200){console.log("æˆåŠŸæ¸…ç©ºå¾®ä¿¡æ–‡ä»¶:",t.data);let e="å¾®ä¿¡æ–‡ä»¶æ¸…ç©ºæˆåŠŸ";return t.data&&t.data.message?(e=t.data.message,console.log("æå–åˆ°messageå­—æ®µ:",e)):console.log("æœªæ‰¾åˆ°messageå­—æ®µï¼Œä½¿ç”¨é»˜è®¤æ¶ˆæ¯"),{success:!0,message:e,data:t.data}}else throw console.error("æ¸…ç©ºå¾®ä¿¡æ–‡ä»¶æ¥å£è¿”å›é”™è¯¯:",t),new Error(t.message||"æ¸…ç©ºå¾®ä¿¡æ–‡ä»¶å¤±è´¥")}catch(t){throw console.error("æ¸…ç©ºå¾®ä¿¡æ–‡ä»¶å¤±è´¥:",t),t}}const F=Object.freeze(Object.defineProperty({__proto__:null,AutoReplyManager:re,autoReplyManager:Y,chatWithAI:Ae,clearChatData:De,clearWechatFiles:ke,countTxtFiles:Ie,forwardMessageToWechat:be,getMockWxData:ie,getWxFriendListAndMessages:le,loadChatData:Ce,saveSettings:Se,transformWxData:te},Symbol.toStringTag,{value:"Module"}));function Te(){const t=A("home"),e=A(null),o=A({}),i=A(""),n=A(!1),l=A([]),a=A({}),d=A(!1),y=A(!1),h=A(!1),v=A("");console.log("useChatåˆå§‹åŒ–ï¼ŒactiveOptionåˆå§‹å€¼:",t.value);const S=oe(()=>e.value?`ä¸ ${e.value.name} çš„å¯¹è¯`:"é»˜è®¤å¯¹è¯"),X=oe(()=>{var r;if(console.log("currentMessageGroupsè®¡ç®—ï¼ŒcurrentContact:",(r=e.value)==null?void 0:r.name),e.value){let u=[];return e.value.type==="wechat"&&a.value[e.value.id]&&(u=[...a.value[e.value.id]],console.log("æ·»åŠ å¾®ä¿¡å†å²æ¶ˆæ¯:",u.length,"æ¡")),o.value[e.value.id]&&(u=[...u,...o.value[e.value.id]],console.log("æ·»åŠ æœ¬åœ°æ–°æ¶ˆæ¯:",o.value[e.value.id].length,"æ¡")),console.log("åˆå¹¶åçš„æ€»æ¶ˆæ¯æ•°:",u.length),u}else return o.value.default?(console.log("è¿”å›é»˜è®¤å¯¹è¯æ¶ˆæ¯:",o.value.default.length,"æ¡"),o.value.default):(console.log("æ²¡æœ‰é»˜è®¤å¯¹è¯æ¶ˆæ¯ï¼Œè¿”å›ç©ºæ•°ç»„"),[])});function B(r){if(console.log("setActiveOptionè¢«è°ƒç”¨ï¼Œä»",t.value,"æ”¹ä¸º",r),console.log("è°ƒç”¨æ ˆ:",new Error().stack),y.value&&r!=="contacts"){console.log("æ­£åœ¨è·å–è”ç³»äººä¸­ï¼Œé˜»æ­¢åˆ‡æ¢åˆ°:",r);return}console.log("å…è®¸åˆ‡æ¢åˆ°:",r),t.value=r,r==="default"?(e.value=null,console.log("åˆ‡æ¢åˆ°é»˜è®¤å¯¹è¯ï¼Œæ¸…ç©ºcurrentContact")):r==="contacts"?(e.value=null,console.log("åˆ‡æ¢åˆ°è”ç³»äººé¡µé¢ï¼Œæ¸…ç©ºå½“å‰é€‰ä¸­çš„è”ç³»äººï¼Œé‡æ–°æ˜¾ç¤ºè”ç³»äººåˆ—è¡¨")):(e.value=null,console.log("åˆ‡æ¢åˆ°å…¶ä»–é¡µé¢ï¼Œæ¸…ç©ºcurrentContact")),r==="contacts"&&console.log("é€‰æ‹©contactsé€‰é¡¹ï¼Œä¿æŒå½“å‰åŠ è½½çŠ¶æ€:",n.value),r==="home"&&(i.value=""),console.log("setActiveOptionå®Œæˆï¼Œå½“å‰é€‰é¡¹:",t.value)}function x(r){console.log("é€‰æ‹©è”ç³»äºº:",r.name),e.value=r,t.value="contacts",o.value[r.id]||(o.value[r.id]=[]),console.log("é€‰æ‹©è”ç³»äººåï¼Œå½“å‰activeOption:",t.value)}async function K(r){if(r.trim()){we();const u=Z();let p;if(e.value?(o.value[e.value.id]||(o.value[e.value.id]=[]),p=o.value[e.value.id]):(o.value.default||(o.value.default=[]),p=o.value.default),p){const $={id:u,type:"received",content:r};p.push($);const L=Z(),Q={id:L,type:"sent",content:"æ­£åœ¨å›å¤",isWaiting:!0};p.push(Q),e.value?o.value[e.value.id]=[...p]:o.value.default=[...p];try{console.log("è°ƒç”¨AIèŠå¤©æ¥å£:",r);const{chatWithAI:N}=await G(()=>Promise.resolve().then(()=>F),void 0),W=e.value?e.value.name:"default",w=await N(r,W),P=p.findIndex(f=>f.id===L);P!==-1&&p.splice(P,1);let D=[];if(Array.isArray(w))D=w;else if(typeof w=="string")try{const f=JSON.parse(w);Array.isArray(f)?D=f:D=[w]}catch{D=[w]}else typeof w=="object"&&w?Array.isArray(w.data)?D=w.data:Array.isArray(w.message)?D=w.message:Array.isArray(w.content)?D=w.content:w.data?D=[w.data]:w.message?D=[w.message]:D=[JSON.stringify(w)]:D=[String(w)];D.forEach(f=>{let m=String(f).trim();m&&p.push({id:Z(),type:"sent",content:m,isWaiting:!1})}),e.value?o.value[e.value.id]=[...p]:o.value.default=[...p]}catch(N){console.error("AIèŠå¤©å¤±è´¥ï¼Œä½¿ç”¨æ¨¡æ‹Ÿå›å¤:",N);const W=p.findIndex(w=>w.id===L);W!==-1&&(p[W]={id:L,type:"sent",content:"æŠ±æ­‰ï¼ŒAIæš‚æ—¶æ— æ³•å›å¤ï¼Œè¯·ç¨åå†è¯•ã€‚",isWaiting:!1,isError:!0},e.value?o.value[e.value.id]=[...p]:o.value.default=[...p])}}}}function z(){i.value=""}async function V(){try{console.log("fetchWxFriendListå¼€å§‹ï¼Œå½“å‰activeOption:",t.value),y.value=!0,d.value=!0;try{const r=await le(),{contacts:u,messages:p}=te(r);return l.value=u,a.value=p,n.value=!0,u.length>0&&(x(u[0]),console.log("è‡ªåŠ¨é€‰æ‹©ç¬¬ä¸€ä¸ªè”ç³»äºº:",u[0].name)),console.log("æˆåŠŸè·å–å¾®ä¿¡å¥½å‹åˆ—è¡¨:",u),console.log("å¾®ä¿¡æ¶ˆæ¯è®°å½•:",p),console.log("è·å–å®Œæˆåï¼Œå½“å‰activeOption:",t.value),{contacts:u,messages:p}}catch(r){console.warn("åç«¯APIè°ƒç”¨å¤±è´¥ï¼Œä½¿ç”¨æ¨¡æ‹Ÿæ•°æ®:",r);const{contacts:u,messages:p}=ie();return l.value=u,a.value=p,n.value=!0,u.length>0&&(x(u[0]),console.log("ä½¿ç”¨æ¨¡æ‹Ÿæ•°æ®ï¼Œè‡ªåŠ¨é€‰æ‹©ç¬¬ä¸€ä¸ªè”ç³»äºº:",u[0].name)),console.log("ä½¿ç”¨æ¨¡æ‹Ÿæ•°æ®:",u),console.log("æ¨¡æ‹Ÿæ•°æ®å®Œæˆåï¼Œå½“å‰activeOption:",t.value),{contacts:u,messages:p}}}catch(r){throw console.error("è·å–å¾®ä¿¡å¥½å‹åˆ—è¡¨å¤±è´¥:",r),r}finally{d.value=!1,y.value=!1,console.log("fetchWxFriendListå®Œæˆï¼Œæœ€ç»ˆactiveOption:",t.value)}}async function se(r){try{console.log("å¼€å§‹å¯åŠ¨è‡ªåŠ¨å›å¤:",r),h.value=!0,v.value="æ­£åœ¨å¯åŠ¨è‡ªåŠ¨å›å¤...",await Y.connect(r,u=>{console.log("æ”¶åˆ°è‡ªåŠ¨å›å¤æ¶ˆæ¯:",u),u.code===200?u.status==="stopped"?(h.value=!1,v.value="è‡ªåŠ¨å›å¤å·²åœæ­¢",console.log("WebSocketé€šçŸ¥ï¼šè‡ªåŠ¨å›å¤å·²åœæ­¢")):u.status==="disconnected"?(h.value=!1,v.value="è¿æ¥å·²æ–­å¼€",console.log("WebSocketé€šçŸ¥ï¼šè¿æ¥å·²æ–­å¼€"),window.dispatchEvent&&window.dispatchEvent(new CustomEvent("auto-reply-disconnected"))):(h.value=!0,v.value="è‡ªåŠ¨å›å¤å·²å¯åŠ¨",console.log("WebSocketé€šçŸ¥ï¼šè‡ªåŠ¨å›å¤å·²å¯åŠ¨")):u.code===400?(h.value=!1,v.value=`å‚æ•°é”™è¯¯: ${u.message||"æœªçŸ¥é”™è¯¯"}`,console.log("WebSocketé€šçŸ¥ï¼šå‚æ•°é”™è¯¯")):(h.value=!1,v.value=`å¯åŠ¨å¤±è´¥: ${u.message||"æœªçŸ¥é”™è¯¯"}`,console.log("WebSocketé€šçŸ¥ï¼šå¯åŠ¨å¤±è´¥"))},u=>{console.error("è‡ªåŠ¨å›å¤è¿æ¥é”™è¯¯:",u),h.value=!1,v.value=`è¿æ¥å¤±è´¥: ${u.message||"æœªçŸ¥é”™è¯¯"}`}),console.log("è‡ªåŠ¨å›å¤å¯åŠ¨æˆåŠŸ")}catch(u){throw console.error("å¯åŠ¨è‡ªåŠ¨å›å¤å¤±è´¥:",u),h.value=!1,v.value=`å¯åŠ¨å¤±è´¥: ${u.message||"æœªçŸ¥é”™è¯¯"}`,u}}async function k(){try{console.log("å¼€å§‹åœæ­¢è‡ªåŠ¨å›å¤"),await Y.stopAutoReply(),h.value=!1,v.value="æ­£åœ¨åœæ­¢è‡ªåŠ¨å›å¤...",console.log("åœæ­¢è‡ªåŠ¨å›å¤æŒ‡ä»¤å·²å‘é€ï¼Œæœ¬åœ°çŠ¶æ€å·²æ›´æ–°")}catch(r){throw console.error("åœæ­¢è‡ªåŠ¨å›å¤å¤±è´¥:",r),h.value=!1,v.value="åœæ­¢å¤±è´¥",r}}function C(){return{isActive:h.value,status:v.value,currentFriend:Y.getStatus().currentFriend}}return{activeOption:t,currentContact:e,contactMessages:o,newMessage:i,contactsLoaded:n,wxContacts:l,wxMessages:a,isLoadingWxData:d,isGettingContacts:y,isAutoReplyActive:h,autoReplyStatus:v,currentChatTitle:S,currentMessageGroups:X,setActiveOption:B,selectContact:x,sendMessage:K,clearMessageInput:z,fetchWxFriendList:V,startAutoReply:se,stopAutoReply:k,getAutoReplyStatus:C}}const U=(t,e)=>{const o=t.__vccOpts||t;for(const[i,n]of e)o[i]=n;return o},Me={name:"Sidebar",props:{activeOption:{type:String,required:!0},currentContact:{type:Object,default:null},contactsLoaded:{type:Boolean,default:!1},wxContacts:{type:Array,default:()=>[]},isLoadingWxData:{type:Boolean,default:!1}},emits:["option-change","contact-select","get-wx-contacts"],methods:{handleGetContacts(){if(this.isLoadingWxData){console.log("æ­£åœ¨è·å–è”ç³»äººï¼Œå¿½ç•¥é‡å¤ç‚¹å‡»");return}this.$emit("get-wx-contacts")}}},Pe={class:"sidebar"},Oe={class:"sidebar-options"},Re={key:0,class:"loading-spinner"},Le={key:0,class:"contacts-list"},We={key:0,class:"loading-state"},xe={key:1},Ne=["onClick"],Ge={class:"contact-avatar"},Fe={class:"contact-info"},Ue={class:"contact-name"},Be={class:"contact-status"},Ke={key:0,class:"contact-selected-indicator"},Ve={key:2,class:"no-contacts"},He={key:3,class:"initial-state"};function je(t,e,o,i,n,l){return c(),g("div",Pe,[e[12]||(e[12]=s("div",{class:"sidebar-header"},[s("div",{class:"welcome-icon"},"ğŸ¤–"),s("div",{class:"agent-name"},"Avatar agent")],-1)),s("div",Oe,[s("div",{class:T(["option-item",{active:o.activeOption==="home"}]),onClick:e[0]||(e[0]=a=>t.$emit("option-change","home"))},e[4]||(e[4]=[s("span",{class:"option-icon"},"ğŸ ",-1),s("span",null,"é¦–é¡µ",-1)]),2),s("div",{class:T(["option-item",{active:o.activeOption==="settings"}]),onClick:e[1]||(e[1]=a=>t.$emit("option-change","settings"))},e[5]||(e[5]=[s("span",{class:"option-icon"},"âš™ï¸",-1),s("span",null,"æˆ‘çš„",-1)]),2),s("div",{class:T(["option-item",{active:o.activeOption==="default"}]),onClick:e[2]||(e[2]=a=>t.$emit("option-change","default"))},e[6]||(e[6]=[s("span",{class:"option-icon"},"ğŸ’¬",-1),s("span",null,"é»˜è®¤å¯¹è¯",-1)]),2),s("div",{class:T(["option-item",{active:o.activeOption==="contacts"||o.currentContact&&o.contactsLoaded,loading:o.isLoadingWxData,disabled:o.isLoadingWxData}]),onClick:e[3]||(e[3]=(...a)=>l.handleGetContacts&&l.handleGetContacts(...a))},[e[7]||(e[7]=s("span",{class:"option-icon"},"ğŸ‘¥",-1)),s("span",null,E(o.isLoadingWxData?"è·å–ä¸­...":"è·å–å½“å‰è”ç³»äºº"),1),o.isLoadingWxData?(c(),g("span",Re,"â³")):I("",!0)],2)]),o.contactsLoaded&&o.wxContacts.length>0?(c(),g("div",Le,[o.isLoadingWxData?(c(),g("div",We,e[8]||(e[8]=[s("div",{class:"loading-spinner-large"},"â³",-1),s("div",{class:"loading-text"},"æ­£åœ¨è·å–å¾®ä¿¡è”ç³»äºº...",-1)]))):I("",!0),o.contactsLoaded&&o.wxContacts.length>0?(c(),g("div",xe,[e[9]||(e[9]=s("div",{class:"contacts-header"},"å¾®ä¿¡è”ç³»äºº",-1)),(c(!0),g(q,null,ee(o.wxContacts,a=>(c(),g("div",{class:T(["contact-item wechat-contact",{selected:o.currentContact&&o.currentContact.id===a.id}]),key:a.id,onClick:d=>t.$emit("contact-select",a)},[s("div",Ge,E(a.avatar),1),s("div",Fe,[s("div",Ue,E(a.name),1),s("div",Be,E(a.status),1),o.currentContact&&o.currentContact.id===a.id?(c(),g("div",Ke," âœ“ å½“å‰èŠå¤© ")):I("",!0)])],10,Ne))),128))])):o.contactsLoaded&&o.wxContacts.length===0?(c(),g("div",Ve,e[10]||(e[10]=[s("div",{class:"no-contacts-icon"},"ğŸ“­",-1),s("div",{class:"no-contacts-text"},"æš‚æ— å¾®ä¿¡è”ç³»äºº",-1)]))):(c(),g("div",He,e[11]||(e[11]=[s("div",{class:"initial-icon"},"ğŸ‘¥",-1),s("div",{class:"initial-text"},"ç‚¹å‡»ä¸Šæ–¹æŒ‰é’®è·å–å¾®ä¿¡è”ç³»äºº",-1)])))])):I("",!0)])}const Ye=U(Me,[["render",je],["__scopeId","data-v-4dedcfc3"]]);const qe={name:"HomePage"},Je={class:"home-page"};function Xe(t,e,o,i,n,l){return c(),g("div",Je,e[0]||(e[0]=[ce('<div class="welcome-container" data-v-a0bedc44><div class="welcome-icon-large" data-v-a0bedc44>ğŸ¤–</div><div class="welcome-title" data-v-a0bedc44>æ¬¢è¿ä½¿ç”¨ Avatar agent</div><div class="welcome-subtitle" data-v-a0bedc44>æ‚¨çš„åˆ†èº«AIåŠ©æ‰‹</div><div class="welcome-description" data-v-a0bedc44> é€‰æ‹©å·¦ä¾§èœå•å¼€å§‹ä½¿ç”¨ï¼Œæˆ–ç›´æ¥å¼€å§‹å¯¹è¯ </div></div>',1)]))}const ze=U(qe,[["render",Xe],["__scopeId","data-v-a0bedc44"]]);const $e={name:"ChatInterface",props:{chatTitle:{type:String,required:!0},messageGroups:{type:Array,default:()=>[]},currentContact:{type:Object,default:null},autoReplyStatus:{type:Object,default:()=>({isActive:!1,status:""})}},data(){return{newMessage:"",autoReplyEnabled:!1}},emits:["send-message","auto-reply-change","forward-message"],computed:{isDefaultChat(){return this.chatTitle==="é»˜è®¤å¯¹è¯"},syncAutoReplyStatus(){return this.autoReplyStatus.isActive}},watch:{messageGroups:{handler(){this.$nextTick(()=>{this.scrollToBottom()})},deep:!0},syncAutoReplyStatus:{handler(t){console.log("ChatInterfaceæ¥æ”¶åˆ°è‡ªåŠ¨å›å¤çŠ¶æ€å˜åŒ–:",t),this.autoReplyEnabled=t},immediate:!0}},mounted(){document.addEventListener("keydown",this.handleGlobalKeydown),this.$nextTick(()=>{this.scrollToBottom()})},beforeUnmount(){document.removeEventListener("keydown",this.handleGlobalKeydown)},methods:{sendMessage(){this.newMessage.trim()&&(this.$emit("send-message",this.newMessage),this.newMessage="")},async forwardToWechat(t){try{if(console.log("è½¬å‘æ¶ˆæ¯è‡³å¾®ä¿¡:",t.content),!this.currentContact){console.warn("æ²¡æœ‰é€‰ä¸­è”ç³»äººï¼Œæ— æ³•è½¬å‘");return}const e=[{[this.currentContact.name]:t.content}],o=await this.$emit("forward-message",e);console.log("è½¬å‘æˆåŠŸ:",o)}catch(e){console.error("è½¬å‘å¤±è´¥:",e)}},async toggleAutoReply(){try{if(this.autoReplyEnabled)this.autoReplyEnabled=!1,this.$emit("auto-reply-change",!1);else if(this.currentContact)this.autoReplyEnabled=!0,this.$emit("auto-reply-change",!0,this.currentContact.name);else{console.warn("æ²¡æœ‰é€‰ä¸­è”ç³»äººï¼Œæ— æ³•å¯åŠ¨è‡ªåŠ¨å›å¤");return}}catch(t){console.error("åˆ‡æ¢è‡ªåŠ¨å›å¤çŠ¶æ€å¤±è´¥:",t),this.autoReplyEnabled=!1}},scrollToBottom(){this.$nextTick(()=>{const t=this.$refs.messagesContainer;t&&(t.scrollTop=t.scrollHeight)})},disableAutoReply(){this.autoReplyEnabled=!1,this.$emit("auto-reply-change",!1)},handleGlobalKeydown(t){t.key==="F10"&&this.autoReplyEnabled&&this.disableAutoReply()}}},Qe={class:"chat-container"},Ze={class:"chat-header"},et={class:"chat-title"},tt={class:"chat-messages",ref:"messagesContainer"},st={key:0,class:"user-message"},ot={class:"message-content"},at={class:"user-name"},nt={class:"message-bubble user-bubble"},lt={key:1,class:"ai-message"},it=["onClick"],rt={class:"message-content"},ct={key:0,class:"waiting-dots"},dt={key:1},ut={key:1},gt={class:"chat-input"},ht={class:"input-container"},ft={class:"input-area"},vt={class:"input-actions"},mt={class:"auto-reply-icon"},pt={class:"auto-reply-text"};function yt(t,e,o,i,n,l){return c(),g("div",Qe,[s("div",Ze,[s("div",et,E(o.chatTitle),1)]),s("div",tt,[(c(!0),g(q,null,ee(o.messageGroups,a=>(c(),g("div",{class:T(["message",a.type]),key:a.id},[a.type==="received"?(c(),g("div",st,[s("div",ot,[s("div",at,E(o.currentContact?o.currentContact.name:"ç”¨æˆ·"),1),s("div",nt,E(a.content),1)])])):(c(),g("div",lt,[a.isWaiting?I("",!0):(c(),g("button",{key:0,class:"forward-button",onClick:d=>l.forwardToWechat(a),title:"è½¬å‘è‡³å¾®ä¿¡"},e[4]||(e[4]=[s("span",{class:"forward-icon"},"â†—",-1)]),8,it)),s("div",rt,[s("div",{class:T(["message-bubble ai-bubble",{waiting:a.isWaiting,error:a.isError}])},[a.isWaiting?(c(),g("span",ct,e[5]||(e[5]=[ue(" æ­£åœ¨å›å¤ ",-1),s("div",{class:"loading-spinner"},null,-1)]))):(c(),g("div",dt,[Array.isArray(a.content)?(c(!0),g(q,{key:0},ee(a.content,(d,y)=>(c(),g("div",{key:y,class:"message-item"},E(typeof d=="object"?d.message||d.content||JSON.stringify(d):d),1))),128)):(c(),g("span",ut,E(a.content),1))]))],2)]),e[6]||(e[6]=s("div",{class:"ai-avatar"},[s("div",{class:"robot-avatar"},"ğŸ¤–")],-1))]))],2))),128))],512),s("div",gt,[s("div",ht,[s("div",ft,[O(s("textarea",{"onUpdate:modelValue":e[0]||(e[0]=a=>n.newMessage=a),placeholder:"è¾“å…¥æ¶ˆæ¯...",onKeydown:e[1]||(e[1]=de(J((...a)=>l.sendMessage&&l.sendMessage(...a),["prevent"]),["enter"])),ref:"messageInput",rows:"3"},null,544),[[R,n.newMessage]])]),s("div",vt,[l.isDefaultChat?I("",!0):(c(),g("button",{key:0,class:T(["auto-reply-button",{enabled:n.autoReplyEnabled}]),onClick:e[2]||(e[2]=(...a)=>l.toggleAutoReply&&l.toggleAutoReply(...a)),type:"button"},[s("span",mt,E(n.autoReplyEnabled?"ğŸ”´":"ğŸŸ¢"),1),s("span",pt,E(n.autoReplyEnabled?"è‡ªåŠ¨å›å¤ä¸­":"å¯ç”¨è‡ªåŠ¨å›å¤"),1)],2)),s("button",{class:"send-button",onClick:e[3]||(e[3]=(...a)=>l.sendMessage&&l.sendMessage(...a))},e[7]||(e[7]=[s("span",{class:"send-icon"},"â¤",-1),s("span",{class:"send-text"},"å‘é€",-1)]))])])])])}const wt=U($e,[["render",yt],["__scopeId","data-v-d6c10a34"]]);const _t={name:"SettingsPage",props:{wechatDataStatus:{type:Object,required:!0}},data(){return{activeTab:"system",settings:{OPENAI_API_KEY:"",OPENAI_MODEL:"deepseek-chat",OPENAI_API_BASE:"https://api.deepseek.com",REDIS_URL:"redis://localhost:6379",SERPAPI_API_KEY:"",EMBEDDING_MODEL:"moka-ai/m3e-base",BAIDU_API_KEY:""},hiddenSettings:{QDRANT_PATH:"bot/local_qdrand",QDRANT_COLLECTION:"wechat_chat_history"},showModal:!1,modalTitle:"",modalMessage:"",modalType:"message",modalConfirmText:"ç¡®å®š",modalCancelText:"å–æ¶ˆ",modalResolve:null,isLoadingChatData:!1,isClearingChatData:!1,chatDataStatus:null}},methods:{async saveSettings(){try{if(console.log("å¼€å§‹ä¿å­˜è®¾ç½®:",this.settings),!this.settings.OPENAI_API_KEY||!this.settings.OPENAI_MODEL||!this.settings.OPENAI_API_BASE||!this.settings.REDIS_URL){this.showMessage("éªŒè¯å¤±è´¥","è¯·å¡«å†™æ‰€æœ‰å¿…å¡«å­—æ®µï¼");return}const t={};Object.entries(this.settings).forEach(([i,n])=>{n&&n.trim()!==""&&(t[i]=n.trim())}),Object.entries(this.hiddenSettings).forEach(([i,n])=>{t[i]=n}),console.log("è¿‡æ»¤åçš„è®¾ç½®ï¼ˆåªåŒ…å«æœ‰å€¼çš„é¡¹ï¼‰:",t),console.log("åŒ…å«éšè—é…ç½®é¡¹:",Object.keys(this.hiddenSettings));const{saveSettings:e}=await G(()=>Promise.resolve().then(()=>F),void 0),o=await e(t);if(o.success){const i=typeof o.message=="string"?o.message:"è®¾ç½®å·²ä¿å­˜";this.showMessage("ä¿å­˜æˆåŠŸ",i),console.log("è®¾ç½®ä¿å­˜æˆåŠŸ:",o)}else this.showMessage("ä¿å­˜å¤±è´¥","è®¾ç½®ä¿å­˜å¤±è´¥ï¼Œè¯·é‡è¯•")}catch(t){console.error("ä¿å­˜è®¾ç½®å¤±è´¥:",t),this.showMessage("ä¿å­˜å¤±è´¥",`ä¿å­˜è®¾ç½®å¤±è´¥ï¼š${t.message}`)}},resetToDefaults(){this.settings={OPENAI_API_KEY:"",OPENAI_MODEL:"deepseek-chat",OPENAI_API_BASE:"https://api.deepseek.com",REDIS_URL:"redis://localhost:6379",SERPAPI_API_KEY:"",EMBEDDING_MODEL:"moka-ai/m3e-base",BAIDU_API_KEY:""}},showMessage(t,e){this.modalTitle=t,this.modalMessage=e,this.modalType="message",this.showModal=!0},closeModal(){this.showModal=!1,this.modalTitle="",this.modalMessage="",this.modalType="message",this.modalConfirmText="ç¡®å®š",this.modalCancelText="å–æ¶ˆ",this.modalResolve=null},handleModalConfirm(){this.modalResolve&&this.modalResolve(!0),this.closeModal()},handleModalCancel(){this.modalResolve&&this.modalResolve(!1),this.closeModal()},async loadChatData(){this.$emit("wechat-data-processing","load")},async clearChatData(){try{if(!await this.showConfirmDialog("ç¡®è®¤æ¸…ç©ºå¾®ä¿¡å¯¼å‡ºæ–‡ä»¶","ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰å¾®ä¿¡å¯¼å‡ºçš„CSVå’ŒTXTæ–‡ä»¶å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ï¼","æ¸…ç©º","å–æ¶ˆ"))return;this.$emit("wechat-data-processing","clear")}catch(t){console.error("æ¸…ç©ºå¾®ä¿¡å¯¼å‡ºæ–‡ä»¶å¤±è´¥:",t)}},showConfirmDialog(t,e,o="ç¡®å®š",i="å–æ¶ˆ"){return new Promise(n=>{this.modalTitle=t,this.modalMessage=e,this.modalType="confirm",this.modalConfirmText=o,this.modalCancelText=i,this.showModal=!0,this.modalResolve=n})},computed:{wechatDataLoading(){return this.wechatDataStatus.isLoadingChatData},wechatDataProcessing(){return this.wechatDataStatus.isProcessingWechatData},wechatDataStatusMessage(){return this.wechatDataStatus.chatDataStatus},wechatDataClearing(){return this.wechatDataStatus.isClearingChatData}},activated(){console.log("SettingsPageç»„ä»¶è¢«æ¿€æ´»ï¼Œå½“å‰çŠ¶æ€:",{isLoadingChatData:this.wechatDataStatus.isLoadingChatData,isProcessingWechatData:this.wechatDataStatus.isProcessingWechatData,chatDataStatus:this.wechatDataStatus.chatDataStatus})}}},Et={class:"settings-page"},bt={class:"settings-container"},At={class:"settings-tabs"},St={key:0,class:"tab-content"},Ct={class:"form-section"},Dt={class:"form-group"},It={class:"form-group"},kt={class:"form-group"},Tt={class:"form-group"},Mt={class:"form-section"},Pt={class:"form-group"},Ot={class:"form-group"},Rt={class:"form-group"},Lt={class:"form-actions"},Wt={key:1,class:"tab-content"},xt={class:"knowledge-settings"},Nt={class:"knowledge-actions"},Gt={class:"action-group"},Ft={class:"action-buttons"},Ut=["disabled"],Bt={key:0},Kt={key:1},Vt=["disabled"],Ht={key:0},jt={key:1},Yt={class:"action-status"},qt={key:0,class:"info"},Jt={class:"modal-header"},Xt={class:"modal-body"},zt={class:"modal-footer"};function $t(t,e,o,i,n,l){return c(),g("div",Et,[s("div",bt,[e[38]||(e[38]=s("div",{class:"settings-header"},[s("h1",null,"è®¾ç½®"),s("p",null,"é…ç½®ç³»ç»Ÿå‚æ•°å’ŒçŸ¥è¯†åº“")],-1)),s("div",At,[s("button",{class:T(["tab-button",{active:n.activeTab==="system"}]),onClick:e[0]||(e[0]=a=>n.activeTab="system")}," ç³»ç»Ÿè®¾ç½® ",2),s("button",{class:T(["tab-button",{active:n.activeTab==="knowledge"}]),onClick:e[1]||(e[1]=a=>n.activeTab="knowledge")}," çŸ¥è¯†åº“è®¾ç½® ",2)]),n.activeTab==="system"?(c(),g("div",St,[s("form",{class:"settings-form",onSubmit:e[10]||(e[10]=J((...a)=>l.saveSettings&&l.saveSettings(...a),["prevent"]))},[s("div",Ct,[e[27]||(e[27]=s("h3",null,"å¿…å¡«é…ç½®",-1)),s("div",Dt,[e[19]||(e[19]=s("label",{for:"openai-api-key"},"OPENAI API KEY *",-1)),O(s("input",{id:"openai-api-key","onUpdate:modelValue":e[2]||(e[2]=a=>n.settings.OPENAI_API_KEY=a),type:"password",placeholder:"sk-...",required:""},null,512),[[R,n.settings.OPENAI_API_KEY]]),e[20]||(e[20]=s("small",null,"DeepSeek APIå¯†é’¥ï¼Œå¿…å¡«",-1))]),s("div",It,[e[21]||(e[21]=s("label",{for:"openai-model"},"OPENAI MODEL *",-1)),O(s("input",{id:"openai-model","onUpdate:modelValue":e[3]||(e[3]=a=>n.settings.OPENAI_MODEL=a),type:"text",placeholder:"deepseek-chat",required:""},null,512),[[R,n.settings.OPENAI_MODEL]]),e[22]||(e[22]=s("small",null,"ä½¿ç”¨çš„AIæ¨¡å‹åç§°ï¼Œå¿…å¡«",-1))]),s("div",kt,[e[23]||(e[23]=s("label",{for:"openai-api-base"},"OPENAI API BASE *",-1)),O(s("input",{id:"openai-api-base","onUpdate:modelValue":e[4]||(e[4]=a=>n.settings.OPENAI_API_BASE=a),type:"url",placeholder:"https://api.deepseek.com",required:""},null,512),[[R,n.settings.OPENAI_API_BASE]]),e[24]||(e[24]=s("small",null,"APIåŸºç¡€URLï¼Œå¿…å¡«",-1))]),s("div",Tt,[e[25]||(e[25]=s("label",{for:"redis-url"},"REDIS URL *",-1)),O(s("input",{id:"redis-url","onUpdate:modelValue":e[5]||(e[5]=a=>n.settings.REDIS_URL=a),type:"text",placeholder:"redis://localhost:6379",required:""},null,512),[[R,n.settings.REDIS_URL]]),e[26]||(e[26]=s("small",null,"Redisè¿æ¥åœ°å€ï¼Œå¿…å¡«",-1))])]),s("div",Mt,[e[34]||(e[34]=s("h3",null,"å¯é€‰é…ç½®",-1)),s("div",Pt,[e[28]||(e[28]=s("label",{for:"serpapi-api-key"},"SERPAPI API KEY",-1)),O(s("input",{id:"serpapi-api-key","onUpdate:modelValue":e[6]||(e[6]=a=>n.settings.SERPAPI_API_KEY=a),type:"password",placeholder:"è¾“å…¥SerpAPIå¯†é’¥..."},null,512),[[R,n.settings.SERPAPI_API_KEY]]),e[29]||(e[29]=s("small",null,"SerpAPIæœç´¢æœåŠ¡å¯†é’¥",-1))]),s("div",Ot,[e[30]||(e[30]=s("label",{for:"embedding-model"},"EMBEDDING MODEL",-1)),O(s("input",{id:"embedding-model","onUpdate:modelValue":e[7]||(e[7]=a=>n.settings.EMBEDDING_MODEL=a),type:"text",placeholder:"moka-ai/m3e-base"},null,512),[[R,n.settings.EMBEDDING_MODEL]]),e[31]||(e[31]=s("small",null,"æ–‡æœ¬åµŒå…¥æ¨¡å‹åç§°",-1))]),s("div",Rt,[e[32]||(e[32]=s("label",{for:"baidu-api-key"},"BAIDU API KEY",-1)),O(s("input",{id:"baidu-api-key","onUpdate:modelValue":e[8]||(e[8]=a=>n.settings.BAIDU_API_KEY=a),type:"password",placeholder:"è¾“å…¥ç™¾åº¦äº‘APIå¯†é’¥..."},null,512),[[R,n.settings.BAIDU_API_KEY]]),e[33]||(e[33]=s("small",null,"ç™¾åº¦äº‘APIå¯†é’¥",-1))])]),s("div",Lt,[s("button",{type:"button",class:"btn btn-secondary",onClick:e[9]||(e[9]=(...a)=>l.resetToDefaults&&l.resetToDefaults(...a))}," é‡ç½®ä¸ºé»˜è®¤å€¼ "),e[35]||(e[35]=s("button",{type:"submit",class:"btn btn-primary"}," ä¿å­˜è®¾ç½® ",-1))])],32)])):I("",!0),n.activeTab==="knowledge"?(c(),g("div",Wt,[s("div",xt,[e[37]||(e[37]=s("div",{class:"info-box"},[s("div",{class:"info-icon"},"â„¹ï¸"),s("div",{class:"info-content"},[s("h3",null,"ä½¿ç”¨è¯´æ˜"),s("p",null,"è¯·å…ˆåœ¨ PyWxDump ç•Œé¢æå–èŠå¤©è®°å½•ï¼Œç„¶ååœ¨æ­¤ç•Œé¢è¿›è¡ŒçŸ¥è¯†åº“æ“ä½œã€‚")])],-1)),s("div",Nt,[s("div",Gt,[e[36]||(e[36]=s("h3",null,"å¾®ä¿¡æ•°æ®å¤„ç†",-1)),s("div",Ft,[s("button",{class:"btn btn-primary",onClick:e[11]||(e[11]=(...a)=>l.loadChatData&&l.loadChatData(...a)),disabled:t.wechatDataLoading||t.wechatDataProcessing},[t.wechatDataLoading?(c(),g("span",Bt,"å¤„ç†ä¸­...")):(c(),g("span",Kt,"æ‰§è¡Œå¾®ä¿¡æ•°æ®å¤„ç†"))],8,Ut),s("button",{class:"btn btn-danger",onClick:e[12]||(e[12]=(...a)=>l.clearChatData&&l.clearChatData(...a)),disabled:t.wechatDataClearing},[t.wechatDataClearing?(c(),g("span",Ht,"æ¸…ç©ºä¸­...")):(c(),g("span",jt,"æ¸…ç©ºå¾®ä¿¡å¯¼å‡ºæ–‡ä»¶"))],8,Vt)]),s("div",Yt,[t.wechatDataLoading?(c(),g("p",qt," â³ æ­£åœ¨æ‰§è¡Œå¾®ä¿¡æ•°æ®å¤„ç†ï¼Œè¯·è€å¿ƒç­‰å¾…... ")):t.wechatDataStatusMessage?(c(),g("p",{key:1,class:T(t.wechatDataStatusMessage.type)},E(t.wechatDataStatusMessage.message),3)):I("",!0)])])])])])):I("",!0)]),n.showModal?(c(),g("div",{key:0,class:"modal-overlay",onClick:e[18]||(e[18]=(...a)=>l.closeModal&&l.closeModal(...a))},[s("div",{class:"modal-content",onClick:e[17]||(e[17]=J(()=>{},["stop"]))},[s("div",Jt,[s("h3",null,E(n.modalTitle),1),s("button",{class:"modal-close",onClick:e[13]||(e[13]=(...a)=>l.closeModal&&l.closeModal(...a))},"Ã—")]),s("div",Xt,[s("p",null,E(n.modalMessage),1)]),s("div",zt,[n.modalType==="confirm"?(c(),g(q,{key:0},[s("button",{class:"modal-btn modal-btn-secondary",onClick:e[14]||(e[14]=(...a)=>l.handleModalCancel&&l.handleModalCancel(...a))},E(n.modalCancelText),1),s("button",{class:"modal-btn modal-btn-primary",onClick:e[15]||(e[15]=(...a)=>l.handleModalConfirm&&l.handleModalConfirm(...a))},E(n.modalConfirmText),1)],64)):(c(),g("button",{key:1,class:"modal-btn modal-btn-primary",onClick:e[16]||(e[16]=(...a)=>l.closeModal&&l.closeModal(...a))}," ç¡®å®š "))])])])):I("",!0)])}const Qt=U(_t,[["render",$t],["__scopeId","data-v-cd421a23"]]);const Zt={name:"App",components:{Sidebar:Ye,HomePage:ze,ChatInterface:wt,SettingsPage:Qt},setup(){const{activeOption:t,currentContact:e,contactMessages:o,newMessage:i,contactsLoaded:n,currentChatTitle:l,currentMessageGroups:a,wxContacts:d,wxMessages:y,isLoadingWxData:h,isGettingContacts:v,setActiveOption:S,selectContact:X,sendMessage:B,clearMessageInput:x,fetchWxFriendList:K,startAutoReply:z,stopAutoReply:V,getAutoReplyStatus:se}=Te(),k=A(!1),C=A(null),r=A({isLoadingChatData:!1,isProcessingWechatData:!1,isClearingChatData:!1,chatDataStatus:null}),u=A({show:!1,title:"",message:"",type:"message"});ge(()=>{console.log("Appç»„ä»¶æŒ‚è½½å®Œæˆï¼Œåˆå§‹çŠ¶æ€:"),console.log("- activeOption:",t.value),console.log("- currentContact:",e.value),console.log("- contactsLoaded:",n.value),he(()=>{_e()}),window.addEventListener("auto-reply-disconnected",()=>{console.log("æ”¶åˆ°WebSocketæ–­å¼€äº‹ä»¶ï¼Œè§£é™¤å°é”çŠ¶æ€"),k.value=!1,C.value&&(C.value.autoReplyEnabled=!1)});const f=m=>{k.value&&(m.key==="F10"||m.key==="Escape")&&(console.log("å…¨å±€é”®ç›˜äº‹ä»¶ï¼š",m.key,"è¢«æŒ‰ä¸‹"),m.preventDefault(),p())};window.addEventListener("keydown",f),console.log("å…¨å±€é”®ç›˜äº‹ä»¶ç›‘å¬å™¨å·²æ·»åŠ "),fe(()=>{window.removeEventListener("keydown",f),console.log("å…¨å±€é”®ç›˜äº‹ä»¶ç›‘å¬å™¨å·²æ¸…ç†")})});const p=async()=>{try{console.log("F10/ESCæŒ‰é”®è¢«æŒ‰ä¸‹ï¼Œåœæ­¢è‡ªåŠ¨å›å¤"),await V(),k.value=!1,C.value&&(C.value.autoReplyEnabled=!1),console.log("é€šè¿‡F10/ESCæˆåŠŸåœæ­¢è‡ªåŠ¨å›å¤")}catch(f){console.error("é€šè¿‡F10/ESCåœæ­¢è‡ªåŠ¨å›å¤å¤±è´¥:",f),k.value=!1,C.value&&(C.value.autoReplyEnabled=!1)}},$=()=>{k.value=!1,C.value&&(C.value.autoReplyEnabled=!1)},L=async(f,m)=>{try{console.log("=== è‡ªåŠ¨å›å¤çŠ¶æ€å˜åŒ– ==="),console.log("enabled:",f),console.log("friendName:",m),console.log("å½“å‰autoReplyEnabledçŠ¶æ€:",k.value),f&&m?(console.log("ğŸŸ¢ å‡†å¤‡å¯åŠ¨è‡ªåŠ¨å›å¤:",m),console.log("è°ƒç”¨startAutoReplyæ–¹æ³•..."),await z(m),console.log("âœ… è‡ªåŠ¨å›å¤å¯åŠ¨æˆåŠŸï¼Œè®¾ç½®å°é”çŠ¶æ€"),k.value=!0):(console.log("ğŸ”´ å‡†å¤‡åœæ­¢è‡ªåŠ¨å›å¤"),console.log("è°ƒç”¨stopAutoReplyæ–¹æ³•..."),await V(),console.log("âœ… è‡ªåŠ¨å›å¤åœæ­¢æˆåŠŸï¼Œè§£é™¤å°é”çŠ¶æ€"),k.value=!1),console.log("=== è‡ªåŠ¨å›å¤çŠ¶æ€å˜åŒ–å®Œæˆ ===")}catch(_){console.error("âŒ å¤„ç†è‡ªåŠ¨å›å¤çŠ¶æ€å˜åŒ–å¤±è´¥:",_),k.value=!1,C.value&&(C.value.autoReplyEnabled=!1)}},Q=async f=>{try{console.log("å¤„ç†è½¬å‘æ¶ˆæ¯:",f);const{forwardMessageToWechat:m}=await G(()=>Promise.resolve().then(()=>F),void 0),_=await m(f);console.log("è½¬å‘æˆåŠŸï¼Œè¿”å›ç»“æœ:",_)}catch(m){console.error("è½¬å‘æ¶ˆæ¯å¤±è´¥:",m)}},N=async f=>{try{console.log("å¤„ç†å‘é€æ¶ˆæ¯:",f),await B(f)}catch(m){console.error("å‘é€æ¶ˆæ¯å¤±è´¥:",m)}},W=async()=>{try{console.log("å¼€å§‹è·å–å¾®ä¿¡è”ç³»äººï¼Œå½“å‰é€‰é¡¹:",t.value),console.log("å½“å‰contactsLoadedçŠ¶æ€:",n.value),S("contacts"),console.log("è®¾ç½®é€‰é¡¹ä¸ºcontactsåï¼Œå½“å‰é€‰é¡¹:",t.value),await K(),t.value!=="contacts"&&(console.warn("activeOptionè¢«æ„å¤–é‡ç½®ï¼Œé‡æ–°è®¾ç½®ä¸ºcontacts"),S("contacts")),setTimeout(()=>{t.value!=="contacts"&&(console.warn("å»¶è¿Ÿæ£€æŸ¥å‘ç°activeOptionè¢«é‡ç½®ï¼Œé‡æ–°è®¾ç½®ä¸ºcontacts"),S("contacts")),console.log("å»¶è¿Ÿæ£€æŸ¥åï¼ŒactiveOption:",t.value,"contactsLoaded:",n.value)},100),console.log("æˆåŠŸè·å–å¾®ä¿¡è”ç³»äººï¼Œå½“å‰é€‰é¡¹:",t.value,"contactsLoaded:",n.value)}catch(f){console.error("è·å–å¾®ä¿¡è”ç³»äººå¤±è´¥:",f)}},w=async f=>{try{if(f==="load"){if(r.value.isProcessingWechatData){console.log("å¾®ä¿¡æ•°æ®å¤„ç†æ­£åœ¨è¿›è¡Œä¸­ï¼Œå¿½ç•¥é‡å¤ç‚¹å‡»");return}r.value.isProcessingWechatData=!0,r.value.isLoadingChatData=!0,r.value.chatDataStatus=null,console.log("å¼€å§‹æ‰§è¡Œå¾®ä¿¡æ•°æ®å¤„ç†æµç¨‹...");const{countTxtFiles:m}=await G(()=>Promise.resolve().then(()=>F),void 0),_=await m();_.success?(r.value.chatDataStatus={type:"success",message:_.message||"å¾®ä¿¡æ•°æ®å¤„ç†å®Œæˆ"},P("å¤„ç†æˆåŠŸ",_.message||"å¾®ä¿¡æ•°æ®å¤„ç†å®Œæˆ")):(r.value.chatDataStatus={type:"error",message:_.message||"å¾®ä¿¡æ•°æ®å¤„ç†å¤±è´¥"},P("å¤„ç†å¤±è´¥",_.message||"å¾®ä¿¡æ•°æ®å¤„ç†å¤±è´¥"))}else if(f==="clear"){r.value.isClearingChatData=!0,r.value.chatDataStatus=null,console.log("å¼€å§‹æ¸…ç©ºå¾®ä¿¡å¯¼å‡ºæ–‡ä»¶...");const{clearWechatFiles:m}=await G(()=>Promise.resolve().then(()=>F),void 0),_=await m();console.log("=== App.vueä¸­æ”¶åˆ°çš„result ==="),console.log("result =",_),console.log("result.message =",_.message),console.log("typeof result.message =",typeof _.message),_.success?(r.value.chatDataStatus={type:"success",message:_.message||"å¾®ä¿¡å¯¼å‡ºæ–‡ä»¶æ¸…ç©ºæˆåŠŸï¼"},console.log("å‡†å¤‡æ˜¾ç¤ºå¼¹çª—ï¼Œæ¶ˆæ¯å†…å®¹ =",_.message||"å¾®ä¿¡å¯¼å‡ºæ–‡ä»¶å·²æˆåŠŸæ¸…ç©º"),P("æ¸…ç©ºæˆåŠŸ",_.message||"å¾®ä¿¡å¯¼å‡ºæ–‡ä»¶å·²æˆåŠŸæ¸…ç©º")):(r.value.chatDataStatus={type:"error",message:_.message||"å¾®ä¿¡å¯¼å‡ºæ–‡ä»¶æ¸…ç©ºå¤±è´¥"},P("æ¸…ç©ºå¤±è´¥",_.message||"å¾®ä¿¡å¯¼å‡ºæ–‡ä»¶æ¸…ç©ºå¤±è´¥"))}}catch(m){console.error("å¾®ä¿¡æ•°æ®å¤„ç†å¤±è´¥:",m),r.value.chatDataStatus={type:"error",message:`å¤„ç†å¤±è´¥ï¼š${m.message}`},P("å¤„ç†å¤±è´¥",`å¾®ä¿¡æ•°æ®å¤„ç†å¤±è´¥ï¼š${m.message}`)}finally{f==="load"?(r.value.isLoadingChatData=!1,r.value.isProcessingWechatData=!1):f==="clear"&&(r.value.isClearingChatData=!1)}},P=(f,m)=>{u.value={show:!0,title:f,message:m,type:"message"}};return{activeOption:t,currentContact:e,contactMessages:o,newMessage:i,contactsLoaded:n,autoReplyEnabled:k,chatInterface:C,wxContacts:d,wxMessages:y,isLoadingWxData:h,isGettingContacts:v,wechatDataStatus:r,globalModal:u,currentChatTitle:l,currentMessageGroups:a,setActiveOption:S,selectContact:X,sendMessage:B,clearMessageInput:x,disableAutoReply:$,handleAutoReplyChange:L,handleForwardMessage:Q,handleSendMessage:N,fetchWxFriendList:K,handleGetWxContacts:W,handleF10StopAutoReply:p,handleWechatDataProcessing:w,closeGlobalModal:()=>{u.value.show=!1}}}},es={class:"app-container"},ts={class:"content-area"},ss={key:0,class:"global-auto-reply-overlay"},os={class:"auto-reply-message"},as={class:"auto-reply-text-large"},ns={key:1,class:"wechat-processing-overlay"},ls={class:"global-modal-header"},is={class:"global-modal-body"},rs={class:"global-modal-footer"};function cs(t,e,o,i,n,l){const a=H("Sidebar"),d=H("HomePage"),y=H("SettingsPage"),h=H("ChatInterface");return c(),g("div",es,[ve(a,{"active-option":i.activeOption,"current-contact":i.currentContact,"contacts-loaded":i.contactsLoaded,"wx-contacts":i.wxContacts,"is-loading-wx-data":i.isLoadingWxData,onOptionChange:i.setActiveOption,onContactSelect:i.selectContact,onGetWxContacts:i.handleGetWxContacts},null,8,["active-option","current-contact","contacts-loaded","wx-contacts","is-loading-wx-data","onOptionChange","onContactSelect","onGetWxContacts"]),s("div",ts,[i.activeOption==="home"?(c(),j(d,{key:0})):i.activeOption==="settings"?(c(),j(y,{key:1,"wechat-data-status":i.wechatDataStatus,onWechatDataProcessing:i.handleWechatDataProcessing},null,8,["wechat-data-status","onWechatDataProcessing"])):i.currentContact?(c(),j(h,{key:2,"chat-title":i.currentChatTitle,"message-groups":i.currentMessageGroups,"current-contact":i.currentContact,"auto-reply-status":{isActive:i.autoReplyEnabled,status:""},onSendMessage:i.handleSendMessage,onAutoReplyChange:i.handleAutoReplyChange,onForwardMessage:i.handleForwardMessage,ref:"chatInterface"},null,8,["chat-title","message-groups","current-contact","auto-reply-status","onSendMessage","onAutoReplyChange","onForwardMessage"])):(c(),j(h,{key:3,"chat-title":"é»˜è®¤å¯¹è¯","message-groups":i.currentMessageGroups,"current-contact":null,"auto-reply-status":{isActive:i.autoReplyEnabled,status:""},onSendMessage:i.handleSendMessage,onAutoReplyChange:i.handleAutoReplyChange,onForwardMessage:i.handleForwardMessage,ref:"chatInterface"},null,8,["message-groups","auto-reply-status","onSendMessage","onAutoReplyChange","onForwardMessage"]))]),i.autoReplyEnabled?(c(),g("div",ss,[s("div",os,[e[4]||(e[4]=s("div",{class:"auto-reply-icon-large"},"ğŸ¤–",-1)),s("div",as," è‡ªåŠ¨å›å¤"+E(i.currentContact&&i.currentContact.name?i.currentContact.name:"è”ç³»äºº")+"ä¸­...... ",1),e[5]||(e[5]=s("div",{class:"auto-reply-hint"},"(F10 æˆ– ESC å–æ¶ˆ)",-1))])])):I("",!0),i.wechatDataStatus.isLoadingChatData||i.wechatDataStatus.isProcessingWechatData?(c(),g("div",ns,e[6]||(e[6]=[s("div",{class:"wechat-processing-message"},[s("div",{class:"wechat-processing-icon"},"ğŸ“Š"),s("div",{class:"wechat-processing-text"}," æ­£åœ¨æ‰§è¡Œå¾®ä¿¡æ•°æ®å¤„ç†ï¼Œè¯·è€å¿ƒç­‰å¾…... "),s("div",{class:"wechat-processing-spinner"},"â³")],-1)]))):I("",!0),i.globalModal.show?(c(),g("div",{key:2,class:"global-modal-overlay",onClick:e[3]||(e[3]=(...v)=>i.closeGlobalModal&&i.closeGlobalModal(...v))},[s("div",{class:"global-modal-content",onClick:e[2]||(e[2]=J(()=>{},["stop"]))},[s("div",ls,[s("h3",null,E(i.globalModal.title),1),s("button",{class:"global-modal-close",onClick:e[0]||(e[0]=(...v)=>i.closeGlobalModal&&i.closeGlobalModal(...v))},"Ã—")]),s("div",is,[s("p",null,E(i.globalModal.message),1)]),s("div",rs,[s("button",{class:"global-modal-btn global-modal-btn-primary",onClick:e[1]||(e[1]=(...v)=>i.closeGlobalModal&&i.closeGlobalModal(...v))}," ç¡®å®š ")])])])):I("",!0)])}const ds=U(Zt,[["render",cs],["__scopeId","data-v-a19e2d70"]]);me(ds).mount("#app");
